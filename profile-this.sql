
        WITH population AS (
            SELECT Patient_ID AS patient_id, DateOfBirth AS date_of_birth, Sex AS sex
            FROM Patient
            ), age AS (
        SELECT
          Patient_ID AS patient_id,
          CASE WHEN
             dateadd(year, datediff (year, DateOfBirth, '2020-02-01'), DateOfBirth) > '2020-02-01'
          THEN
             datediff(year, DateOfBirth, '2020-02-01') - 1
          ELSE
             datediff(year, DateOfBirth, '2020-02-01')
          END AS age
        FROM Patient
        ), sex AS (
          SELECT
            Patient_ID AS patient_id,
            Sex as sex
          FROM Patient), imd AS (
            SELECT Patient_ID AS patient_id, ImdRankRounded AS index_of_multiple_deprivation
            FROM PatientAddress
            WHERE StartDate <= '2020-02-01' AND EndDate > '2020-02-01'
            ), rural_urban AS (
            SELECT Patient_ID AS patient_id, RuralUrbanClassificationCode AS rural_urban_classification
            FROM PatientAddress
            WHERE StartDate <= '2020-02-01' AND EndDate > '2020-02-01'
            ), geographic_area AS (
            SELECT Patient_ID AS patient_id, Organisation.STPCode AS stp_code
            FROM RegistrationHistory
            LEFT JOIN Organisation
            ON Organisation.Organisation_ID = RegistrationHistory.Organisation_ID
            WHERE StartDate <= '2020-02-01' AND EndDate > '2020-02-01'
            ), bmi AS (
        SELECT
          patients.Patient_ID AS patient_id,
          ROUND(COALESCE(weight/SQUARE(NULLIF(height, 0)), bmis.BMI), 1) AS BMI,
          CONVERT(VARCHAR(7),
            CASE
              WHEN weight IS NULL OR height IS NULL THEN bmis.ConsultationDate
              ELSE weights.ConsultationDate
            END
            , 23) AS date_measured
        FROM (
           SELECT Patient_ID, DateOfBirth
           FROM Patient
        ) AS patients
        LEFT JOIN (
          SELECT t.Patient_ID, t.weight, t.ConsultationDate
          FROM (
            SELECT Patient_ID, NumericValue AS weight, ConsultationDate,
            ROW_NUMBER() OVER (PARTITION BY Patient_ID ORDER BY ConsultationDate DESC) AS rownum
            FROM CodedEvent
            WHERE CTV3Code IN ('X76C7','22A.. ') AND ConsultationDate >= '2010-02-01'
          ) t
          WHERE t.rownum = 1
        ) AS weights
        ON weights.Patient_ID = patients.Patient_ID AND DATEDIFF(YEAR, patients.DateOfBirth, weights.ConsultationDate) >= 16
        LEFT JOIN (
          SELECT t.Patient_ID, t.height, t.ConsultationDate
          FROM (
            SELECT Patient_ID, NumericValue AS height, ConsultationDate,
            ROW_NUMBER() OVER (PARTITION BY Patient_ID ORDER BY ConsultationDate DESC) AS rownum
            FROM CodedEvent
            WHERE CTV3Code IN ('XM01E','229..') AND 1=1
          ) t
          WHERE t.rownum = 1
        ) AS heights
        ON heights.Patient_ID = patients.Patient_ID AND DATEDIFF(YEAR, patients.DateOfBirth, heights.ConsultationDate) >= 16
        LEFT JOIN (
        SELECT t.Patient_ID, t.BMI, t.ConsultationDate
        FROM (
          SELECT Patient_ID, NumericValue AS BMI, ConsultationDate,
          ROW_NUMBER() OVER (PARTITION BY Patient_ID ORDER BY ConsultationDate DESC) AS rownum
          FROM CodedEvent
          WHERE CTV3Code = '22K..' AND ConsultationDate >= '2010-02-01'
        ) t
        WHERE t.rownum = 1
        ) AS bmis
        ON bmis.Patient_ID = patients.Patient_ID AND DATEDIFF(YEAR, patients.DateOfBirth, bmis.ConsultationDate) >= 16
        -- XXX maybe add a "WHERE NULL..." here
        ), chronic_respiratory_disease AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('23E5.','663K.','7450','7450y','7450z','A114.','A115.','A7899','AD52.','C370.','C370.','C3700','C3701','C3701','C3702','C3703','C370z','H0614','H3...','H3...','H31..','H310.','H3100','H310z','H311.','H3110','H311z','H3121','H3122','H312z','H313.','H31y.','H31y0','H31y1','H31yz','H31z.','H32..','H320.','H3200','H3201','H3202','H3203','H320z','H321.','H322.','H32y.','H32y0','H32y1','H32y2','H32y2','H32yz','H32z.','H34..','H340.','H341.','H34z.','H35..','H35..','H350.','H351.','H352.','H3520','H3521','H352z','H353.','H354.','H355.','H356.','H357.','H35y.','H35y0','H35y1','H35y2','H35y3','H35y4','H35y5','H35y6','H35y7','H35y8','H35yz','H35z.','H35z0','H35z1','H3y..','H3y..','H3y0.','H3y1.','H3z..','H3z..','H4...','H40..','H41..','H41z.','H42..','H420.','H421.','H422.','H423.','H42z.','H43..','H430.','H431.','H432.','H433.','H434.','H435.','H43z.','H44..','H440.','H441.','H44z.','H45..','H450.','H460.','H4601','H460z','H464.','H4640','H4641','H4642','H464z','H46z0','H47..','H4y0.','H4y00','H4y0z','H4y1.','H4y10','H4y1z','H4y2.','H4y20','H4y21','H52y1','H5302','H5410','H55..','H561.','H563.','H5631','H563z','H56y0','H571.','H572.','H57y0','H57y1','H57y2','H57y3','H57y4','H581.','H582.','H583.','H591.','Hy02.','Hyu30','Hyu31','Hyu40','Hyu41','Hyu43','Hyu47','Hyu50','K260.','L380.','N0421','N0421','N04y0','P851.','P861.','PK35.','Q317.','Q3170','Q3171','Q3172','Q317z','Qyu36','SP130','SP131','X00s1','X00s2','X00s3','X00s4','X100V','X100l','X100m','X100n','X100o','X100p','X100q','X100r','X100t','X101U','X101U','X101X','X101Z','X101a','X101b','X101c','X101d','X101e','X101i','X101j','X101k','X101l','X101m','X101n','X101o','X101p','X101q','X101r','X1025','X1026','X1027','X1028','X102B','X102H','X102J','X102K','X102L','X102M','X102N','X102O','X102P','X102Q','X102R','X102S','X102T','X102U','X102j','X102j','X102k','X102u','X102v','X102v','X102w','X102x','X102y','X102z','X1030','X1031','X1032','X1033','X1034','X1035','X1038','X103A','X103G','X103W','X103X','X103Y','X103Y','X103Z','X103a','X103b','X103c','X103d','X103e','X103f','X103h','X103i','X103j','X103k','X103l','X103m','X103n','X103o','X103p','X103q','X103r','X103s','X103u','X103v','X103w','X103x','X1043','X1044','X1045','X1046','X1047','X1048','X1049','X104B','X104C','X309R','X701k','X701k','X70Eg','X70RL','XE0YM','XE0YN','XE0YO','XE0YO','XE0YP','XE0YY','XE0Ya','XE0Ya','XE0Yb','XE0Yb','XE0ZN','XE0ZV','XE0ZX','XE0ZZ','XE0Zf','XE0Zh','XE0Zr','XE1NO','XE1ep','XE2Pp','XE2Pp','XM1Qc','XSC3p','Xa08A','Xa0BC','Xa0Qe','Xa0Qi','Xa0Qj','Xa0Tw','Xa35l','Xa9Bw','Xa9Bw','Xa9Bx','XaBDb','XaBDb','XaEIV','XaEIW','XaEIY','XaEKI','XaIND','XaIQT','XaIQg','XaIQg','XaIQh','XaIRO','XaIUt','XaIes','XaIes','XaIet','XaIu7','XaIu8','XaJ4k','XaJFu','XaJYf','XaJlS','XaJlT','XaJlU','XaJlV','XaJlW','XaJlY','XaK8Q','XaK8R','XaK8S','XaK8U','XaKv8','XaKv9','XaKzy','XaL2O','XaLcH','XaLqj','XaMzI','XaN4a','XaO5l','XaO5m','XaOYV','XaPZH','XaPZH','XaPls','XaPls','XaPlu','XaPlu','XaPzu','XaQvd','XaRCG','XaRCH','XaREX','XaREZ','XaREa','XaREd','XaW9D','XaXCa','XaXCb','XaXi9','XaXlE','XaXlF','XaXlJ','XaXnt','XaXzy','XaY05','XaY0w','XaYR1','XaYZO','XaYbA','XaYby','XaYuZ','XaZ6U','XaZ6U','XaZ8t','XaZd1','XaZee','XaZoz','XaZp7','XaZp8','XaZr7','Xaa7C','Xaam4','XaavA','Xabud','Xac33','Xac8s','XafhZ','Xafhe','Xafir','Xafit','Xafiu','Y1f1b','Y1f94','Y1f95','Y2708','Y2710') AND 1=1
            GROUP BY Patient_ID
            ), recent_asthma_code AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(4), MAX(ConsultationDate), 23) AS last_date
            FROM CodedEvent
            WHERE CTV3Code IN ('14B4.','173A.','173A.','173A.','663N.','663N.','663N0','663N0','663N1','663N1','663N2','663N2','663O.','663O0','663O0','663P.','663P.','663Q.','663U.','663V.','663V0','663V0','663V1','663V1','663V2','663V2','663V3','663V3','663W.','663d.','663e.','663e.','663e0','663e0','663e1','663e1','663f.','663f.','679J.','8791.','8793.','8794.','8795.','8796.','8797.','8798.','8H2P.','8H2P.','9OJ1.','9OJ3.','9OJ4.','9OJ5.','9OJ6.','9OJ7.','9OJ8.','9OJ9.','9OJA.','9Q21.','H3120','H3120','H3120','H33..','H33..','H33..','H330.','H330.','H3300','H3300','H3301','H3301','H330z','H330z','H331.','H331.','H3310','H3310','H3311','H3311','H331z','H331z','H331z','H332.','H332.','H33z.','H33z.','H33z.','H33z0','H33z0','H33z1','H33z1','H33z2','H33z2','H33zz','H33zz','H47y0','H47y0','Ua1AX','Ua1AX','X101t','X101t','X101u','X101u','X101u','X101x','X101x','X101x','X101y','X101y','X101y','X101z','X101z','X101z','X1020','X1020','X1020','X1021','X1021','X1022','X1022','X1022','X1023','X1023','X1024','X1024','X1025','X1025','X1026','X1026','X1027','X1027','X1028','X1028','X1029','X1029','X102D','X102D','X102G','XE0YQ','XE0YQ','XE0YQ','XE0YR','XE0YR','XE0YR','XE0YS','XE0YS','XE0YS','XE0YT','XE0YT','XE0YU','XE0YU','XE0YU','XE0YV','XE0YV','XE0YV','XE0YW','XE0YW','XE0YW','XE0YX','XE0YX','XE0YX','XE0ZP','XE0ZP','XE0ZR','XE0ZR','XE0ZT','XE0ZT','XE2Nb','XE2Nb','XE2Nb','XM0s2','XM0s2','XM0s2','XM1Xb','Xa0lZ','Xa0lZ','Xa1hD','Xa1hD','Xa8Hn','Xa9zf','Xa9zf','XaBAQ','XaBU2','XaBU3','XaDvK','XaDvK','XaDvL','XaIIW','XaIIX','XaIIY','XaIIZ','XaIIZ','XaINZ','XaINZ','XaINa','XaINa','XaINb','XaINb','XaINc','XaINc','XaINd','XaINd','XaINf','XaINf','XaINg','XaINg','XaINh','XaIOV','XaIQ4','XaIQ4','XaIQD','XaIQD','XaIQE','XaIQE','XaIR3','XaIR3','XaIRN','XaIeq','XaIeq','XaIer','XaIer','XaIfK','XaIfK','XaIoE','XaIoE','XaIu5','XaIu5','XaIu6','XaIu6','XaIuG','XaIuG','XaIww','XaJFG','XaJFG','XaJYe','XaKdk','XaKdk','XaLIm','XaLIn','XaLIr','XaLJS','XaLJT','XaLJU','XaLPE','XaLPE','XaNKw','XaNKw','XaObi','XaObj','XaObk','XaObl','XaObm','XaQHq','XaQig','XaQih','XaQij','XaR8K','XaRFi','XaRFj','XaRFk','XaRFl','XaX3n','XaX3n','XaXZm','XaXZm','XaXZp','XaXZp','XaXZs','XaXZs','XaXZu','XaXZu','XaXZx','XaXZx','XaXa0','XaY2V','XaY2V','XaYZB','XaYZh','XaYZh','XaYb8','XaYja','XaYpF','Xaa7B','Xaa7B','Xaa7Q','Xabiu','Xabj3','Xac33','Xac8r','XacLz','XacM0','XacM1','XacXj','Xafdj','Xafdj','Xafdj','Xafdy','Xafdy','Xafdz','Xafdz','Xaff0','Y0017','Y0017','Y137e','Y137f','Y138a','Y139b','Y139c','Y139d','Y13a1','Y13a2','Y13a3','Y13a4','Y13a5','Y13a7','Y13a8','Y13a9','Y1b24','Y1b24','Y1f90') AND ConsultationDate BETWEEN '2018-02-01' AND '2020-02-01'
            GROUP BY Patient_ID
            ), asthma_code_ever AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(4), MAX(ConsultationDate), 23) AS last_date
            FROM CodedEvent
            WHERE CTV3Code IN ('14B4.','173A.','173A.','173A.','663N.','663N.','663N0','663N0','663N1','663N1','663N2','663N2','663O.','663O0','663O0','663P.','663P.','663Q.','663U.','663V.','663V0','663V0','663V1','663V1','663V2','663V2','663V3','663V3','663W.','663d.','663e.','663e.','663e0','663e0','663e1','663e1','663f.','663f.','679J.','8791.','8793.','8794.','8795.','8796.','8797.','8798.','8H2P.','8H2P.','9OJ1.','9OJ3.','9OJ4.','9OJ5.','9OJ6.','9OJ7.','9OJ8.','9OJ9.','9OJA.','9Q21.','H3120','H3120','H3120','H33..','H33..','H33..','H330.','H330.','H3300','H3300','H3301','H3301','H330z','H330z','H331.','H331.','H3310','H3310','H3311','H3311','H331z','H331z','H331z','H332.','H332.','H33z.','H33z.','H33z.','H33z0','H33z0','H33z1','H33z1','H33z2','H33z2','H33zz','H33zz','H47y0','H47y0','Ua1AX','Ua1AX','X101t','X101t','X101u','X101u','X101u','X101x','X101x','X101x','X101y','X101y','X101y','X101z','X101z','X101z','X1020','X1020','X1020','X1021','X1021','X1022','X1022','X1022','X1023','X1023','X1024','X1024','X1025','X1025','X1026','X1026','X1027','X1027','X1028','X1028','X1029','X1029','X102D','X102D','X102G','XE0YQ','XE0YQ','XE0YQ','XE0YR','XE0YR','XE0YR','XE0YS','XE0YS','XE0YS','XE0YT','XE0YT','XE0YU','XE0YU','XE0YU','XE0YV','XE0YV','XE0YV','XE0YW','XE0YW','XE0YW','XE0YX','XE0YX','XE0YX','XE0ZP','XE0ZP','XE0ZR','XE0ZR','XE0ZT','XE0ZT','XE2Nb','XE2Nb','XE2Nb','XM0s2','XM0s2','XM0s2','XM1Xb','Xa0lZ','Xa0lZ','Xa1hD','Xa1hD','Xa8Hn','Xa9zf','Xa9zf','XaBAQ','XaBU2','XaBU3','XaDvK','XaDvK','XaDvL','XaIIW','XaIIX','XaIIY','XaIIZ','XaIIZ','XaINZ','XaINZ','XaINa','XaINa','XaINb','XaINb','XaINc','XaINc','XaINd','XaINd','XaINf','XaINf','XaINg','XaINg','XaINh','XaIOV','XaIQ4','XaIQ4','XaIQD','XaIQD','XaIQE','XaIQE','XaIR3','XaIR3','XaIRN','XaIeq','XaIeq','XaIer','XaIer','XaIfK','XaIfK','XaIoE','XaIoE','XaIu5','XaIu5','XaIu6','XaIu6','XaIuG','XaIuG','XaIww','XaJFG','XaJFG','XaJYe','XaKdk','XaKdk','XaLIm','XaLIn','XaLIr','XaLJS','XaLJT','XaLJU','XaLPE','XaLPE','XaNKw','XaNKw','XaObi','XaObj','XaObk','XaObl','XaObm','XaQHq','XaQig','XaQih','XaQij','XaR8K','XaRFi','XaRFj','XaRFk','XaRFl','XaX3n','XaX3n','XaXZm','XaXZm','XaXZp','XaXZp','XaXZs','XaXZs','XaXZu','XaXZu','XaXZx','XaXZx','XaXa0','XaY2V','XaY2V','XaYZB','XaYZh','XaYZh','XaYb8','XaYja','XaYpF','Xaa7B','Xaa7B','Xaa7Q','Xabiu','Xabj3','Xac33','Xac8r','XacLz','XacM0','XacM1','XacXj','Xafdj','Xafdj','Xafdj','Xafdy','Xafdy','Xafdz','Xafdz','Xaff0','Y0017','Y0017','Y137e','Y137f','Y138a','Y139b','Y139c','Y139d','Y13a1','Y13a2','Y13a3','Y13a4','Y13a5','Y13a7','Y13a8','Y13a9','Y1b24','Y1b24','Y1f90') AND 1=1
            GROUP BY Patient_ID
            ), copd_code_ever AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(4), MAX(ConsultationDate), 23) AS last_date
            FROM CodedEvent
            WHERE CTV3Code IN ('23E5.','663K.','7450','7450y','7450z','A114.','A115.','A7899','AD52.','C370.','C370.','C3700','C3701','C3701','C3702','C3703','C370z','H0614','H3...','H3...','H31..','H310.','H3100','H310z','H311.','H3110','H311z','H3121','H3122','H312z','H313.','H31y.','H31y0','H31y1','H31yz','H31z.','H32..','H320.','H3200','H3201','H3202','H3203','H320z','H321.','H322.','H32y.','H32y0','H32y1','H32y2','H32y2','H32yz','H32z.','H34..','H340.','H341.','H34z.','H35..','H35..','H350.','H351.','H352.','H3520','H3521','H352z','H353.','H354.','H355.','H356.','H357.','H35y.','H35y0','H35y1','H35y2','H35y3','H35y4','H35y5','H35y6','H35y7','H35y8','H35yz','H35z.','H35z0','H35z1','H3y..','H3y..','H3y0.','H3y1.','H3z..','H3z..','H4...','H40..','H41..','H41z.','H42..','H420.','H421.','H422.','H423.','H42z.','H43..','H430.','H431.','H432.','H433.','H434.','H435.','H43z.','H44..','H440.','H441.','H44z.','H45..','H450.','H460.','H4601','H460z','H464.','H4640','H4641','H4642','H464z','H46z0','H47..','H4y0.','H4y00','H4y0z','H4y1.','H4y10','H4y1z','H4y2.','H4y20','H4y21','H52y1','H5302','H5410','H55..','H561.','H563.','H5631','H563z','H56y0','H571.','H572.','H57y0','H57y1','H57y2','H57y3','H57y4','H581.','H582.','H583.','H591.','Hy02.','Hyu30','Hyu31','Hyu40','Hyu41','Hyu43','Hyu47','Hyu50','K260.','L380.','N0421','N0421','N04y0','P851.','P861.','PK35.','Q317.','Q3170','Q3171','Q3172','Q317z','Qyu36','SP130','SP131','X00s1','X00s2','X00s3','X00s4','X100V','X100l','X100m','X100n','X100o','X100p','X100q','X100r','X100t','X101U','X101U','X101X','X101Z','X101a','X101b','X101c','X101d','X101e','X101i','X101j','X101k','X101l','X101m','X101n','X101o','X101p','X101q','X101r','X1025','X1026','X1027','X1028','X102B','X102H','X102J','X102K','X102L','X102M','X102N','X102O','X102P','X102Q','X102R','X102S','X102T','X102U','X102j','X102j','X102k','X102u','X102v','X102v','X102w','X102x','X102y','X102z','X1030','X1031','X1032','X1033','X1034','X1035','X1038','X103A','X103G','X103W','X103X','X103Y','X103Y','X103Z','X103a','X103b','X103c','X103d','X103e','X103f','X103h','X103i','X103j','X103k','X103l','X103m','X103n','X103o','X103p','X103q','X103r','X103s','X103u','X103v','X103w','X103x','X1043','X1044','X1045','X1046','X1047','X1048','X1049','X104B','X104C','X309R','X701k','X701k','X70Eg','X70RL','XE0YM','XE0YN','XE0YO','XE0YO','XE0YP','XE0YY','XE0Ya','XE0Ya','XE0Yb','XE0Yb','XE0ZN','XE0ZV','XE0ZX','XE0ZZ','XE0Zf','XE0Zh','XE0Zr','XE1NO','XE1ep','XE2Pp','XE2Pp','XM1Qc','XSC3p','Xa08A','Xa0BC','Xa0Qe','Xa0Qi','Xa0Qj','Xa0Tw','Xa35l','Xa9Bw','Xa9Bw','Xa9Bx','XaBDb','XaBDb','XaEIV','XaEIW','XaEIY','XaEKI','XaIND','XaIQT','XaIQg','XaIQg','XaIQh','XaIRO','XaIUt','XaIes','XaIes','XaIet','XaIu7','XaIu8','XaJ4k','XaJFu','XaJYf','XaJlS','XaJlT','XaJlU','XaJlV','XaJlW','XaJlY','XaK8Q','XaK8R','XaK8S','XaK8U','XaKv8','XaKv9','XaKzy','XaL2O','XaLcH','XaLqj','XaMzI','XaN4a','XaO5l','XaO5m','XaOYV','XaPZH','XaPZH','XaPls','XaPls','XaPlu','XaPlu','XaPzu','XaQvd','XaRCG','XaRCH','XaREX','XaREZ','XaREa','XaREd','XaW9D','XaXCa','XaXCb','XaXi9','XaXlE','XaXlF','XaXlJ','XaXnt','XaXzy','XaY05','XaY0w','XaYR1','XaYZO','XaYbA','XaYby','XaYuZ','XaZ6U','XaZ6U','XaZ8t','XaZd1','XaZee','XaZoz','XaZp7','XaZp8','XaZr7','Xaa7C','Xaam4','XaavA','Xabud','Xac33','Xac8s','XafhZ','Xafhe','Xafir','Xafit','Xafiu','Y1f1b','Y1f94','Y1f95','Y2708','Y2710') AND 1=1
            GROUP BY Patient_ID
            ), recent_salbutamol_count AS (
            SELECT
              Patient_ID AS patient_id,
              COUNT(*) AS count,
              CONVERT(VARCHAR(4), MAX(ConsultationDate), 23) AS last_date
            FROM
            MedicationIssue
            INNER JOIN MedicationDictionary
            ON MedicationIssue.MultilexDrug_ID = MedicationDictionary.MultilexDrug_ID

            WHERE DMD_ID IN ('3408611000001107','3410611000001106','3412611000001107','3415711000001107','3417111000001102','10432311000001108','7511000001105','45111000001100','757611000001104','18041311000001106','840111000001107','3382711000001107','222311000001102','3214211000001100','3218011000001101','106511000001103','3215311000001107','20434411000001107','3186011000001104','3293111000001105','3080411000001101','3086111000001109','3083011000001100','3089011000001102','597011000001101','3214311000001108','3214611000001103','3217611000001109','3384111000001103','9205211000001104','9204911000001109','13533511000001104','13533711000001109','18148111000001107','22503111000001109','35936511000001108','35936411000001109','35937211000001107','35936711000001103','35936911000001101','35936611000001107','35936811000001106','320139002','320141001','320178003','320179006','320151000','9207411000001106','13566211000001103','13566111000001109') AND ConsultationDate BETWEEN '2018-02-01' AND '2020-02-01'
            GROUP BY Patient_ID
            ), recent_ics AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(4), MAX(ConsultationDate), 23) AS last_date
            FROM
            MedicationIssue
            INNER JOIN MedicationDictionary
            ON MedicationIssue.MultilexDrug_ID = MedicationDictionary.MultilexDrug_ID

            WHERE DMD_ID IN ('34681611000001100','3175711000001102','3175911000001100','3176711000001105','3177111000001107','4773611000001100','11400011000001108','17793411000001101','3178211000001102','3178411000001103','3179011000001102','4773811000001101','7379111000001102','11400511000001100','17794111000001108','3179811000001108','3180011000001102','3180911000001103','4774011000001109','7379311000001100','11400811000001102','17833911000001100','4332611000001107','15052211000001104','3180211000001107','3190311000001103','3192111000001101','3194011000001108','3178611000001100','3176211000001103','3179311000001104','3292811000001106','3182411000001107','3181411000001102','3176411000001104','3178811000001101','3180611000001109','3604611000001104','3181711000001108','3182611000001105','3179511000001105','3175211000001109','3177911000001105','3088611000001100','3086011000001108','3096011000001109','3099811000001109','3102211000001109','3104911000001109','3111911000001108','3112511000001109','3174111000001102','3176811000001102','3175611000001106','3177411000001102','3177711000001108','8159511000001107','8159711000001102','9525111000001105','10617711000001103','10618211000001109','10619311000001107','10619611000001102','12906411000001100','31063411000001101','26112111000001106','31063111000001106','35430111000001100','35430311000001103','36603211000001106','36603411000001105','36603611000001108','36603811000001107','2924111000001109','3240911000001108','3112411000001105','3228711000001106','3113111000001106','14951111000001102','15358411000001102','3294211000001101','3294611000001104','4373811000001100','32926011000001100','8031811000001102','9111811000001100','10073911000001106','10074611000001102','10074411000001100','25254111000001105','25254711000001106','34812111000001106','34950311000001108','34950611000001103','31064811000001101','3097711000001109','3098611000001101','3099611000001105','3106311000001102','3103511000001100','3183811000001101','3184311000001107','3184911000001108','3185211000001103','398511000001105','2831211000001109','726611000001102','3186911000001100','3187211000001106','3188311000001102','453611000001102','810211000001105','539811000001106','21019411000001101','21019711000001107','21020611000001104','35647311000001101','35650811000001109','29782111000001107','29782511000001103','30950311000001106','34215311000001107','34215511000001101','33679711000001103','34023611000001101','34023811000001102','34677011000001107','34675711000001103','35515511000001100','35515311000001106','35594011000001105','35594211000001100','35594411000001101','36604711000001102','4045711000001107','4043811000001103','9003911000001102','9004211000001109','23621711000001102','23622011000001107','34952211000001104','34683311000001106','35909511000001107','320537007','35908811000001103','320535004','35907711000001105','35908311000001107','320520000','35909011000001104','35908211000001104','35907611000001101','35908911000001108','35908511000001101','35909211000001109','35907811000001102','35908611000001102','35909611000001106','35908111000001105','35909311000001101','35907911000001107','35909411000001108','35908011000001109','35908711000001106','35909111000001103','35908411000001100','10621011000001101','10621111000001100','12911011000001100','26148711000001101','31087411000001106','31087511000001105','35912811000001103','35912511000001101','35912411000001100','35912711000001106','35912111000001105','35912011000001109','134498003','4378111000001103','8024611000001102','9117811000001107','14959511000001107','15374611000001106','32960711000001105','36059911000001104','36059311000001100','36059211000001108','36059411000001107','36059511000001106','36059711000001101','320602002','320603007','36565411000001101','320605000','320277000','320279002','320280004','320614005','320615006','320274007','320275008','320276009','320618008','21113711000001102','21113811000001105','21113911000001100','35647511000001107','35647611000001106','408026006','408013007','9004511000001107','9004411000001108','23661311000001105','23661411000001103','34955111000001103') AND ConsultationDate BETWEEN '2018-02-01' AND '2020-02-01'
            GROUP BY Patient_ID
            ), chronic_cardiac_disease AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('14A3.','14A4.','14A5.','14A6.','14S3.','323..','3232.','3233.','3234.','3235.','3236.','323Z.','662K.','662K0','662K1','662K2','662K3','662Kz','7900.','79000','79001','7900y','7900z','7901.','79010','79011','79012','79013','79014','79015','7901y','7901z','7902.','7902.','79020','79020','79021','79021','79022','79023','79023','7902y','7902y','7902z','7902z','79030','79030','79031','79031','7903y','7903y','7903z','7903z','7904.','79040','7904y','7904z','7905.','79050','79051','79052','7905y','7905z','790H3','792..','7920.','7920.','79200','79201','79202','79203','7920y','7920z','7921.','7921.','79210','79211','79212','79213','7921y','7921z','7922.','7922.','79220','79221','79222','79223','7922y','7922z','7923.','7923.','79230','79231','79232','79233','7923y','7923z','7924.','79240','79241','79242','79243','79244','79245','7924y','7924z','7925.','7925.','79250','79251','79252','79253','79254','7925y','7925z','7926.','79260','79261','79262','79263','7926y','7926z','7927.','79270','79271','79272','79273','79275','7927y','7927z','7928.','79280','79281','79282','7928y','7928z','7929.','79290','79291','79291','79292','79293','7929y','7929z','792A.','792A0','792Ay','792Az','792B.','792B0','792By','792Bz','792C.','792C0','792Cy','792Cz','792D.','792Dy','792Dz','792y.','792z.','79332','C3733','D4102','G1...','G10..','G100.','G101.','G102.','G10z.','G14..','G1y..','G1yz.','G1yz0','G1yz1','G1yzz','G1z..','G21..','G210.','G2100','G2101','G210z','G211.','G2110','G2111','G211z','G21z.','G21z0','G21z1','G23..','G230.','G231.','G232.','G233.','G234.','G23z.','G3...','G30..','G300.','G301.','G3010','G3011','G301z','G302.','G303.','G304.','G305.','G306.','G307.','G308.','G30y.','G30y0','G30y1','G30y2','G30yz','G30z.','G31..','G310.','G310.','G311.','G3110','G3110','G311z','G312.','G31y0','G31y1','G31y2','G31yz','G32..','G33..','G330.','G3300','G330z','G331.','G331.','G33z.','G33z0','G33z1','G33z2','G33z3','G33zz','G34..','G340.','G3400','G3401','G341.','G3410','G3411','G3412','G3413','G341z','G343.','G34y.','G34y0','G34y1','G34yz','G34z.','G35..','G350.','G351.','G353.','G36..','G360.','G361.','G363.','G364.','G365.','G366.','G3y..','G3z..','G400.','G41..','G41y.','G41yz','G41z.','G5102','G54z2','G55..','G550.','G551.','G552.','G554.','G5540','G5541','G5542','G5543','G5544','G554z','G555.','G557.','G5572','G5574','G557z','G558.','G5580','G5581','G5582','G558z','G55y.','G55y0','G55z.','G58..','G58..','G580.','G5800','G5801','G5802','G5803','G581.','G5810','G582.','G58z.','G5y1.','G5y2.','G5y4.','G5y40','G5y4z','G5yy6','G700.','Gyu14','Gyu30','Gyu31','Gyu32','Gyu33','Gyu34','Gyu35','Gyu36','Gyu5M','Gyu5N','Gyu5P','Gyu5Q','Gyu5R','Gyu5S','Gyu5T','H541z','H584.','H584z','L09y1','L09y2','L1280','L1281','P50..','P50z.','P51..','P510.','P511.','P5110','P5111','P5112','P5113','P511z','P512.','P51y.','P51z.','P52..','P520.','P521.','P52z.','P53..','P54..','P540.','P541.','P542.','P543.','P544.','P545.','P54y.','P54z.','P550.','P553.','P56..','P560.','P56y.','P56z.','P56z2','P57..','P5y..','P5z..','P6...','P60..','P600.','P601.','P6010','P601z','P602.','P6020','P6021','P602z','P603.','P60z.','P60z0','P60z1','P60z2','P60zz','P61..','P610.','P611.','P61z.','P62..','P63..','P64..','P640.','P641.','P64z.','P65..','P650.','P651.','P652.','P653.','P65z.','P66..','P67..','P6y..','P6y0.','P6y1.','P6y2.','P6y3.','P6y30','P6y3z','P6y4.','P6y40','P6y41','P6y42','P6y43','P6y44','P6y45','P6y46','P6y4z','P6y60','P6y62','P6y63','P6y64','P6y6z','P6yy.','P6yy0','P6yy1','P6yy2','P6yy3','P6yy5','P6yy6','P6yy7','P6yy8','P6yy9','P6yyA','P6yyB','P6yyD','P6yyz','P6z..','P6z0.','P6z2.','P6zz.','P71..','P710.','P713.','P71z.','P72..','P720.','P7210','P7211','P7212','P7214','P7215','P7216','P7217','P7217','P721z','P722.','P7220','P7221','P7224','P7225','P722z','P72z.','P72z0','P73..','P730.','P731.','P731.','P732.','P733.','P734.','P735.','P738.','P73y.','P73z.','P74..','P740.','P7400','P7401','P740z','P741.','P7410','P7411','P741z','P74z0','P74z1','P74z2','P74z3','P74z4','P74z5','P74z6','P74z7','P74z8','P74zz','PK34.','PK35.','PKy71','PKyz1','Pyu20','Pyu21','Pyu22','Pyu23','Pyu24','Pyu25','Pyu26','Pyu27','Pyu28','Pyu29','Pyu2G','Pyu2H','Pyu2J','Q48y1','R2y10','SP003','SP084','SP085','SP111','SP2y1','TB000','Ua1eH','X00tE','X00tE','X00tG','X00tH','X00tI','X00tJ','X00tK','X00tL','X00tM','X00tN','X00tO','X00tP','X00tQ','X00tR','X00tS','X00tT','X00tU','X00tX','X00tY','X00tZ','X00ta','X00tb','X00tc','X00td','X00te','X010U','X010l','X010m','X010n','X0111','X102X','X102Y','X102Y','X2006','X2006','X2007','X2007','X2008','X2009','X2009','X200A','X200B','X200C','X200D','X200E','X200E','X200G','X200H','X200I','X200J','X200K','X200L','X200M','X200N','X200O','X200P','X200Q','X200R','X200S','X200T','X200U','X200V','X200W','X200X','X200Y','X200Z','X200a','X200a','X200b','X200c','X200d','X200e','X200e','X200v','X2010','X2018','X201B','X201F','X201H','X201M','X201W','X201X','X201Y','X201Z','X201a','X201b','X201c','X201d','X201e','X201f','X201g','X201h','X202k','X202k','X202l','X202l','X202q','X202r','X202s','X203E','X203E','X203H','X203e','X203k','X203v','X203v','X204f','X204q','X204x','X205P','X207c','X40AV','X708p','X70MZ','X776w','X776x','X777h','X778Q','X778W','X778X','X778j','X77tW','X77tX','X77tY','X77tZ','X77ta','X77td','X77th','X77ti','X77tj','X77tk','X77tl','X77tm','X77to','X77tp','X77tq','X77tr','X77tt','X77tu','X77tv','X77tw','X77tx','X77ty','X77tz','X77u0','X77u1','X77u2','X77u3','X77u4','X77u5','X77u6','X77u7','X77u8','X77u9','X77uB','X77uB','X77uC','X77uE','X77uF','X77uG','X77uH','X77uI','X77uJ','X77uL','X77uM','X77uN','X77uV','X77uX','X77uY','X77uf','X77ug','X77uj','X77uk','X77ul','X77um','X77un','X77uo','X77up','X77uq','X77ur','X77us','X77ut','X77uu','X77uv','X77uw','X77uy','X77uz','X77v0','X77v1','X77v2','X77v3','X77v6','X77v7','X77v8','X77v9','X77vB','X77vC','X77vE','X77vF','X77vK','X77vL','X77vN','X77vO','X77vQ','X77vR','X77vW','X77vX','X77va','X77vc','X77vd','X77ve','X77vf','X77vi','X77vj','X77vn','X77vo','X77vp','X77vr','X77vs','X77vu','X77vv','X77vx','X77vz','X77w1','X77w2','X77w3','X77w4','X77w6','X77w7','X77w8','X77w9','X77wB','X77wD','X77wE','X77wF','X77wH','X77wJ','X77wM','X77wN','X77wO','X77wQ','X77wS','X77wT','X77wV','X77wZ','X77wa','X77wb','X77wc','X77we','X77wf','X77wg','X77wh','X77wi','X77wj','X77wk','X77wl','X77wm','X77wn','X77wo','X77wr','X77ws','X77wt','X77wu','X77ww','X77wx','X77wy','X77wz','X77x0','X77x1','X77x2','X77x3','X77x4','X77x5','X77x7','X77x8','X77x9','X77xA','X77xC','X77xD','X77xE','X77xF','X77xH','X77xI','X77xJ','X77xK','X77xM','X77xP','X77xR','X77xS','X77xT','X77xV','X77xW','X77xX','X77xb','X77xc','X77xe','X77xf','X77xg','X77xh','X77xj','X77xk','X77xl','X77xm','X77xo','X77xr','X77xt','X77xu','X77xv','X77xx','X77xy','X77xz','X77y3','X77y4','X77y6','X77y7','X77y8','X77y9','X77yA','X77yB','X77yC','X77yD','X77yD','X77yE','X77yE','X77yG','X77yH','X77yI','X77yJ','X77yK','X77yN','X77yO','X77yP','X77yQ','X77yR','X77yS','X77yT','X77yU','X77yV','X77yW','X77yX','X77yZ','X77ya','X77yb','X77yc','X77yd','X77yg','X77yh','X77yi','X77yj','X77yk','X77yl','X77ym','X77yo','X77yp','X77yq','X77yr','X77ys','X77yt','X77yu','X77yv','X77yw','X77yx','X77yy','X77yz','X77z0','X77z1','X77z2','X77z3','X77z4','X77z5','X77z6','X77z7','X77z8','X77z9','X77zA','X77zB','X77zC','X77zD','X77zE','X77zF','X77zG','X77zH','X77zK','X77zL','X77zM','X77zN','X77zO','X77zP','X77zQ','X77zR','X77zS','X77zT','X77zU','X77zV','X77zX','X77zY','X77zZ','X77za','X77zc','X77zf','X77zg','X77zh','X77zi','X77zj','X77zk','X77zm','X77zn','X77zo','X77zr','X77zs','X77zu','X77zw','X77zx','X77zy','X77zz','X7800','X7802','X7803','X7804','X7807','X7808','X7809','X780A','X780C','X780D','X780E','X780F','X780G','X780H','X780I','X780J','X780K','X780N','X780O','X780P','X780Q','X780R','X780S','X780T','X780U','X780V','X780W','X780a','X780b','X780c','X780d','X780f','X780i','X780j','X780k','X780m','X780n','X780o','X780q','X780r','X780s','X780t','X780u','X780v','X780w','X780x','X780y','X780z','X7810','X7812','X7813','X7814','X7817','X781C','X781D','X781E','X781F','X781G','X781H','X781I','X781K','X781L','X781M','X781N','X781O','X781P','X781Q','X781b','X781c','X781d','X781e','X781o','X781p','X781q','X781r','X781s','X781t','X781u','X781v','X781w','X781x','X781y','X781z','X7820','X7821','X7822','X7823','X7824','X7825','X7826','X7827','X7828','X7829','X782A','X782B','X782C','X782D','X782E','X782F','X782M','X79u6','X90Qa','X90WS','X90WT','XA0Ae','XC0I6','XC0MC','XC0bX','XE0Em','XE0Em','XE0En','XE0Ue','XE0Uh','XE0Uh','XE0Ui','XE0Ui','XE0Uk','XE0Un','XE0Un','XE0Uy','XE0Uz','XE0V0','XE0V1','XE0V8','XE0V8','XE0V9','XE0V9','XE0Vo','XE0Vq','XE0Vu','XE0Vw','XE0WA','XE0WC','XE0WE','XE0WG','XE0WM','XE0Wa','XE0Wo','XE1KA','XE1KB','XE1KB','XE1KC','XE1KC','XE1KD','XE1KD','XE1KG','XE1KG','XE1KH','XE1KJ','XE1KK','XE1KK','XE1KL','XE1KM','XE1KN','XE1KO','XE1KP','XE1KQ','XE1KQ','XE1KS','XE1KT','XE1NA','XE1NE','XE1NG','XE1p9','XE1p9','XE1tl','XE2Px','XE2Px','XE2QG','XE2QG','XE2Qh','XE2Qh','XE2Qi','XE2Rv','XE2aA','XE2aA','XE2r7','XE2uV','XE2uV','XE2uq','XE2ur','XE2ur','XE2vv','XE2vw','XE2vz','XM00Q','XM0rN','XM0rN','XM0v4','XM1GB','XM1LR','XM1LR','XM1LS','XM1LS','XM1Le','XM1M3','XM1M4','XM1Qk','XM1Qn','XM1Qn','XM1Qp','XM1Qw','XM1Qw','XSDT6','Xa07h','Xa07j','Xa07k','Xa0Kw','Xa0RY','Xa0TT','Xa0TU','Xa0YL','Xa0aP','Xa1dP','Xa1dQ','Xa1dR','Xa1fq','Xa3fK','Xa3fN','Xa3hW','Xa3kl','Xa3km','Xa3kp','Xa3ks','Xa6Yx','Xa7lV','Xa7nH','Xa9Bp','Xa9Cm','Xa9Qh','XaAC3','XaAzi','XaBEB','XaBEB','XaBL1','XaBL2','XaBL4','XaBLr','XaBLt','XaBtO','XaBtP','XaBwi','XaC2P','XaC2P','XaC2Q','XaCIn','XaD2b','XaD2d','XaD2e','XaD2f','XaD2g','XaD2h','XaD2i','XaDki','XaDyY','XaEXt','XaEgY','XaEgZ','XaFsG','XaFsH','XaFx7','XaG1Q','XaI9b','XaI9h','XaIIq','XaINF','XaIOW','XaIQM','XaIQN','XaIf1','XaIfL','XaIpn','XaItG','XaIvK','XaIvL','XaIvM','XaIvN','XaIwM','XaIwY','XaJ4J','XaJ4L','XaJ4M','XaJ98','XaJ99','XaJ9G','XaJ9H','XaJ9I','XaJ9J','XaJIU','XaJJv','XaJX0','XaKNW','XaKyd','XaL1C','XaLN7','XaLNA','XaLSD','XaLeo','XaLep','XaLev','XaLf7','XaLfL','XaLfM','XaLfN','XaLfO','XaLfQ','XaLfS','XaLfT','XaLfU','XaLfW','XaLfX','XaLg5','XaLg6','XaLgU','XaLgV','XaLgW','XaLgX','XaLgY','XaLgZ','XaLga','XaLon','XaLqp','XaMFr','XaMGk','XaMGo','XaMGs','XaMGt','XaMGu','XaMJ9','XaMJA','XaMJB','XaMK5','XaMK6','XaMK7','XaMKA','XaMKB','XaMKC','XaMKD','XaMKE','XaMqN','XaMqN','XaMzU','XaNxN','XaO5n','XaOiT','XaPiK','XaPr5','XaPx1','XaQk7','XaQk7','XaR8o','XaRFL','XaRFO','XaRFP','XaVvs','XaWye','XaWyi','XaWyi','XaX1p','XaXIR','XaXLu','XaXNg','XaXew','XaXex','XaXgq','XaXgs','XaXkR','XaXnr','XaXzw','XaYYq','XaYYr','XaYYs','XaYae','XaYb7','XaYbC','XaYft','XaZKd','XaZSy','XaZcx','XaZih','XaZlp','XaZlr','XaaH6','XaaUg','Xaacj','Xaapw','XabM9','XabvP','XaeVd','XafeB','XagLe','Xagdx','Y1781','Y1eef','Y1f1c','Y1f20','Y1f93','Y1f9c','Y1f9d','Y3657','Y9998','ZV421','ZV457') AND 1=1
            GROUP BY Patient_ID
            ), diabetes AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('13B1.','1434','14P3.','42W1.','42W2.','42W3.','42WZ.','42c0.','42c1.','44V3.','66A3.','66A4.','66A5.','66A6.','66A8.','66A9.','66AA.','66AG.','66AH.','66AH0','66AI.','66AJ.','66AJ0','66AJ1','66AJ2','66AJ3','66AJz','66AK.','66AL.','66AM.','66AN.','66AP.','66AQ.','66AR.','66AS.','66AT.','7L100','8A12.','8A13.','8CA41','8H2J.','8H3O.','8H7C.','8HKE.','8HLE.','8HME.','9NM0.','9OL..','9OL1.','9OL2.','9OL3.','9OL4.','9OL5.','9OL6.','9OL7.','9OL8.','9OL9.','9OLA.','9OLZ.','C10..','C100.','C1000','C1001','C100z','C101.','C1010','C1011','C101y','C101z','C102.','C1020','C1021','C102z','C103.','C1030','C1031','C103y','C103z','C104.','C1040','C1041','C104y','C104z','C105.','C1050','C1051','C105y','C105z','C106.','C1060','C1061','C106y','C106z','C107.','C1070','C1071','C1072','C1073','C1074','C107y','C107z','C1080','C1081','C1082','C1083','C1085','C1086','C1087','C1088','C1089','C108y','C108z','C109.','C1090','C1091','C1092','C1093','C1094','C1095','C1096','C1097','C10y.','C10y0','C10y1','C10yy','C10yz','C10z.','C10z0','C10z1','C10zy','C10zz','C110.','C110z','Cyu20','Cyu21','Cyu22','Cyu23','F1711','F3450','F35z0','F372.','F3720','F3721','F3722','F3813','F3y0.','F420.','F4200','F4201','F4202','F4203','F420z','F4407','F4640','G73y0','K01x1','Kyu03','Lyu29','M0372','M2710','M2711','M2712','N0300','N0301','Q441.','R0542','R0543','X00Ag','X00Ah','X00Ai','X00Aj','X00Ak','X00Al','X00Am','X00An','X00dF','X00dG','X00dH','X00dI','X00dJ','X30Kk','X30Kl','X30Km','X40J4','X40J5','X40J6','X40JG','X40JI','X40JJ','X40JV','X40JW','X40JX','X40JY','X40JZ','X40Ja','X40Jb','X40Jc','X40Je','X40Jj','X40Jk','X40Jo','X40Jq','X40Jr','X40Js','X40Jt','X40KG','X50E7','X50GO','X50GP','X50GQ','X50GR','X50GT','X74WS','XE10E','XE10F','XE10G','XE10H','XE10I','XE10J','XE128','XE12A','XE12C','XE12E','XE12G','XE12I','XE12K','XE12M','XE12Q','XE15k','XE15n','XE18r','XE1T2','XE1T3','XE1V0','XE1V2','XE24t','XE2Nd','XE2Ne','XM0cY','XM0cZ','XM0q4','XM19i','XM19j','XM1Qx','XM1Rs','XM1Xk','XSETH','XSETp','Xa0lK','Xa1J5','Xa2h7','Xa2h9','Xa2hA','Xa3ee','Xa4g7','Xa9FG','XaA6b','XaBLf','XaBLg','XaBTC','XaBU8','XaBU9','XaBZQ','XaBuj','XaBul','XaBun','XaBwj','XaCES','XaCET','XaCEU','XaCEV','XaCGh','XaCJ2','XaD2T','XaE46','XaE4q','XaE5T','XaE5U','XaE5V','XaE5W','XaE5X','XaE5Y','XaE5Z','XaE5a','XaE5c','XaEHw','XaEHx','XaEJQ','XaELP','XaELQ','XaEVO','XaEVP','XaEVS','XaEVT','XaEgI','XaEnn','XaEno','XaEnp','XaEnq','XaF04','XaF05','XaFWG','XaFWI','XaFm8','XaFmA','XaFmK','XaFmL','XaFmM','XaFn7','XaFn8','XaFn9','XaFsp','XaFvj','XaFvk','XaFx7','XaIIe','XaIIj','XaIP5','XaIPk','XaIQS','XaIW8','XaIeH','XaIeI','XaIeJ','XaIeK','XaIeL','XaIeM','XaIeR','XaIeS','XaIeT','XaIeU','XaIeo','XaIfG','XaIfI','XaIfM','XaIok','XaIrL','XaIrM','XaIrf','XaIuE','XaIyt','XaIyu','XaIyz','XaIz0','XaIzM','XaIzN','XaIzQ','XaIzR','XaJ4Q','XaJ4h','XaJ4i','XaJ5j','XaJEN','XaJLa','XaJLb','XaJO3','XaJO4','XaJO9','XaJOD','XaJOE','XaJOO','XaJOg','XaJOh','XaJOi','XaJOj','XaJOk','XaJOl','XaJOn','XaJOo','XaJQp','XaJSr','XaJUH','XaJYg','XaJix','XaJkQ','XaJlI','XaKDG','XaKDH','XaKGs','XaKGy','XaKH0','XaKHD','XaKHh','XaKHi','XaKOF','XaKSn','XaKSp','XaKT5','XaKaW','XaKbu','XaKcS','XaKjW','XaKjX','XaKjY','XaKjZ','XaKtr','XaKvV','XaKvW','XaKwQ','XaKyW','XaKyX','XaKzO','XaL1R','XaL1S','XaL2E','XaL2F','XaLMa','XaLMy','XaLP3','XaLSk','XaLsL','XaMFF','XaMdq','XaMhJ','XaMhK','XaMhQ','XaMzI','XaN1z','XaNHW','XaNT8','XaNTA','XaNTB','XaNTC','XaNTD','XaNTH','XaNTQ','XaNTS','XaNTT','XaNTa','XaNTd','XaNTe','XaNTf','XaNTg','XaNU1','XaNU2','XaNU3','XaON1','XaOPt','XaOPu','XaP4P','XaP5E','XaP63','XaPQH','XaPaa','XaPab','XaPac','XaPad','XaPbv','XaPem','XaPen','XaPjH','XaPjI','XaPjJ','XaPjK','XaPjL','XaPjM','XaPjN','XaPjO','XaPjP','XaPjQ','XaPjR','XaPmW','XaPmX','XaQGH','XaQdT','XaQjs','XaR8L','XaRGt','XaX0F','XaX1n','XaX3o','XaX3p','XaX3q','XaX3r','XaX49','XaX5D','XaX6J','XaX6K','XaX8e','XaXH5','XaXH6','XaXHD','XaXOw','XaXZB','XaXZR','XaXZv','XaXbW','XaXfs','XaXgv','XaXhE','XaXkZ','XaXoT','XaXv9','XaYWU','XaYZP','XaYaB','XaYbB','XaZCO','XaZKr','XaZMQ','XaZNW','XaZRZ','XaZS6','XaZig','XaZlw','XaZpJ','XaZuQ','XaZw5','XaZw7','XaZw8','XaZyM','Xaa8r','XaaCR','XaaCS','XaaCU','XaaJJ','XaaJK','XaaNP','XaaaR','XaadP','XaaeP','Xaag1','Xaaq3','XabAX','XabQM','XabZd','Xabhn','XabjM','Xac0x','XacIu','XacXh','XacXr','XacY8','XaccX','XaceC','XacoB','XacsX','XacsY','Xacu2','Xad5D','XaeBz','XaeC0','XaeWH','Xaes7','Xaffg','Xaffh','Xaffi','Xaffj','Xaffk','Xaffl','Xaffm','Xafj0','Xafj1','Xafj2','XafjT','XagLc','Xagk3','Y0022','Y0502','Y0505','Y0c48','Y0c49','Y1f9a','Y204f','Y205a','Y205b','Y20bf','Y9993','YX128') AND 1=1
            GROUP BY Patient_ID
            ), lung_cancer AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('B22..','B220.','B2200','B2201','B220z','B221.','B2210','B2211','B221z','B222.','B2220','B2221','B222z','B223.','B2230','B2231','B223z','B224.','B2240','B2241','B224z','B225.','B22y.','B22z.','B23..','B230.','B231.','B232.','B23y.','B23z.','B2zy.','B2zz.','BB1K.','BB1L.','BB5S2','BB5S4','Byu20','Byu5.','Byu50','Byu51','X2032','X77mv','X77mw','X77nT','X77oo','X78Q1','X78Q2','X78Q7','X78Q8','X78QF','X78QG','X78QI','X78QJ','X78QK','X78QL','X78QM','X78QN','X78QO','X78QP','X78QQ','X78QR','X78QS','X78QT','X78Qc','XE1vb','XE1vc','XE1yF','XE1yH','XE1yJ','XE1yL','XE1yN','XE1yP','XE1yR','Xa0KG','Xa0bg','XaBAp','XaEJe','XaEJf','XaEJg','XaEJh','XaEJi','XaFr7','XaFrw','XaZzj') AND 1=1
            GROUP BY Patient_ID
            ), haem_cancer AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('4C53.','A7896','A7897','AyuC6','B6...','B60..','B600.','B6000','B6001','B6002','B6003','B6004','B6005','B6006','B6007','B6008','B600z','B601.','B6010','B6011','B6012','B6013','B6014','B6015','B6016','B6017','B6018','B601z','B602.','B6020','B6021','B6022','B6023','B6024','B6025','B6026','B6027','B6028','B602z','B60y.','B60z.','B61..','B611.','B6110','B6111','B6112','B6113','B6114','B6115','B6116','B6117','B6118','B611z','B612.','B6120','B6121','B6122','B6123','B6124','B6125','B6126','B6127','B6128','B612z','B613.','B6130','B6131','B6132','B6133','B6134','B6135','B6136','B6137','B6138','B613z','B614.','B6140','B6141','B6142','B6143','B6144','B6145','B6146','B6147','B6148','B614z','B615.','B6150','B6151','B6152','B6153','B6154','B6155','B6156','B6157','B6158','B615z','B616.','B6160','B6161','B6162','B6163','B6164','B6165','B6166','B6167','B6168','B616z','B61z.','B61z0','B61z1','B61z2','B61z3','B61z4','B61z5','B61z6','B61z7','B61z8','B61zz','B62..','B620.','B6200','B6201','B6202','B6203','B6204','B6205','B6206','B6207','B6208','B620z','B621.','B6210','B6211','B6212','B6213','B6214','B6215','B6216','B6217','B6218','B621z','B622.','B6220','B6221','B6222','B6223','B6224','B6225','B6226','B6227','B6228','B622z','B623.','B6230','B6231','B6232','B6233','B6234','B6235','B6236','B6237','B6238','B623z','B624.','B6240','B6241','B6242','B6243','B6244','B6245','B6246','B6247','B6248','B624z','B625.','B6250','B6251','B6252','B6253','B6254','B6255','B6256','B6257','B6258','B625z','B626.','B6260','B6261','B6262','B6263','B6264','B6265','B6266','B6267','B6268','B626z','B627.','B6271','B6273','B6274','B6275','B6276','B6277','B6278','B627B','B627C','B62x.','B62x5','B62y.','B62y0','B62y1','B62y2','B62y3','B62y4','B62y5','B62y6','B62y7','B62y8','B62z.','B62z0','B62z1','B62z2','B62z3','B62z4','B62z5','B62z6','B62z7','B62z8','B62zz','B63..','B630.','B6300','B6302','B63y.','B63z.','B64..','B640.','B641.','B642.','B64y.','B64y0','B64y1','B64y2','B64yz','B64z.','B65..','B650.','B651.','B6510','B6512','B651z','B652.','B653.','B6530','B6531','B653z','B65y.','B65y0','B65y1','B65yz','B65z.','B66..','B660.','B661.','B662.','B66y.','B66y0','B66yz','B66z.','B67..','B670.','B671.','B672.','B673.','B674.','B675.','B67y.','B67y0','B67yz','B67z.','B68..','B680.','B681.','B682.','B68y.','B68z.','B69..','B690.','B691.','B692.','B6y..','B6z..','BBg1.','BBg10','BBg2.','BBg3.','BBg4.','BBg5.','BBg6.','BBg7.','BBg8.','BBg9.','BBgA.','BBgB.','BBgC.','BBgD.','BBgE.','BBgF.','BBgG.','BBgH.','BBgJ.','BBgK.','BBgL.','BBgM.','BBgN.','BBgP.','BBgQ.','BBgR.','BBgS.','BBgT.','BBgV.','BBgz.','BBh..','BBh1.','BBh2.','BBj..','BBj0.','BBj1.','BBj10','BBj11','BBj2.','BBj3.','BBj4.','BBj5.','BBj6.','BBj60','BBj61','BBj62','BBj7.','BBj9.','BBjA.','BBk..','BBk0.','BBk1.','BBk2.','BBk3.','BBk4.','BBk5.','BBk6.','BBk7.','BBk8.','BBkz.','BBl..','BBl1.','BBlz.','BBm1.','BBm2.','BBm3.','BBm4.','BBm5.','BBm6.','BBm8.','BBmD.','BBmE.','BBmH.','BBn..','BBn0.','BBn2.','BBn3.','BBnz.','BBp1.','BBp2.','BBq..','BBq0.','BBqz.','BBr..','BBr0.','BBr00','BBr01','BBr02','BBr03','BBr04','BBr0z','BBr1.','BBr10','BBr1z','BBr2.','BBr20','BBr21','BBr22','BBr23','BBr24','BBr25','BBr26','BBr27','BBr2z','BBr3.','BBr30','BBr3z','BBr4.','BBr40','BBr41','BBr42','BBr4z','BBr50','BBr5z','BBr6.','BBr60','BBr61','BBr62','BBr63','BBr64','BBr65','BBr66','BBr67','BBr68','BBr6z','BBr7.','BBr70','BBr7z','BBr8.','BBr80','BBr8z','BBr9.','BBr90','BBr91','BBr92','BBr93','BBr94','BBr9z','BBrA.','BBrA0','BBrA1','BBrA2','BBrA3','BBrA5','BBrA7','BBrA8','BBrAz','BBs..','BBs1.','BBv0.','BBv2.','ByuD.','ByuD0','ByuD1','ByuD2','ByuD3','ByuD4','ByuD5','ByuD6','ByuD7','ByuD8','ByuD9','ByuDA','ByuDB','ByuDC','ByuDE','ByuH6','C333.','C3330','C3331','C3332','C333z','C37y0','C37y1','C37y5','C37y6','C37y7','N3309','X00eT','X102I','X20E9','X20HV','X30L7','X30L8','X50BR','X70LK','X78e2','X78hl','X78hm','X78hn','XE13I','XE1vo','XE1vp','XE1vq','XE1vr','XE1wd','XE1we','XE1wf','XE20J','XE20N','XE20P','XE20R','XE20T','XE20V','XE2bV','XE2t9','XE2vi','XM1FM','XS5X2','Xa0DX','Xa0Dd','Xa0E1','Xa0QP','Xa0QQ','Xa0Ri','Xa0Rk','Xa0Rn','Xa0Ro','Xa0Rp','Xa0S9','Xa0SA','Xa0SB','Xa0SC','Xa0SD','Xa0SE','Xa0SF','Xa0SG','Xa0SH','Xa0SL','Xa0SM','Xa0SN','Xa0SV','Xa0SX','Xa0Sk','Xa0Sl','Xa0Sm','Xa0Sn','Xa0So','Xa0St','Xa0Su','Xa0Sv','Xa0Sw','Xa0Sx','Xa0Sy','Xa0Sz','Xa0T0','Xa0T1','Xa0T2','Xa0T3','Xa0T4','Xa0T5','Xa0T7','Xa0T8','Xa0T9','Xa0TA','Xa0TD','Xa0TE','Xa0TF','Xa0TG','Xa0TH','Xa0TI','Xa0TM','Xa0TP','Xa0TS','Xa0TX','Xa0TY','Xa0TZ','Xa0Th','Xa0Ti','Xa0Tj','Xa0Tk','Xa0To','Xa0Tr','Xa0Tt','Xa0Tu','Xa0Ty','Xa0U5','Xa0bR','Xa0bS','Xa0eB','Xa0eC','Xa0jn','Xa36a','Xa36b','Xa36c','Xa3EW','Xa3Ea','Xa3Ec','Xa3Ee','Xa3En','Xa3HG','Xa8Jb','Xa99k','Xa99l','Xa99n','Xa99w','Xa99z','Xa9AA','Xa9AM','Xa9AN','Xa9AO','Xa9AP','Xa9EH','Xa9FC','Xa9FD','Xa9FE','Xa9FF','XaB47','XaBAk','XaBAl','XaBAm','XaBB3','XaBBC','XaBBM','XaBBN','XaBBO','XaBBP','XaBBZ','XaBBb','XaBBc','XaBBd','XaBBf','XaBBo','XaBBp','XaBBs','XaBLw','XaBLx','XaBLz','XaC2n','XaE68','XaELI','XaFpR','XaFpS','XaFpT','XaFpU','XaFpV','XaFpW','XaFpy','XaFpz','XaFqH','XaFqN','XaImp','XaImq','XaImr','XaIms','XaPQD','XaYdL','XaYgm','XaYi5','XaYiI','XaYiL','XaYiN','XaYii','XaYij','XaYil','XaYim','XaYin','XaYip','XaYis','XaYj0','XaYj4','XaYj9','XaYjI','XaYje','XaYjf','XaYk0','XaYv2','XaZdD','XaZdF','XaZdn','XaZfR','Xaa1N','Xaa1O','Xaa1P','Xaa8z','Y1b23') AND 1=1
            GROUP BY Patient_ID
            ), other_cancer AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('7G03J','A7886','A7895','A7898','AyuC8','AyuC9','B0...','B00..','B000.','B0000','B0001','B000z','B0010','B0011','B001z','B002.','B0020','B0021','B002z','B0030','B0031','B0032','B003z','B004.','B0041','B0042','B0043','B004z','B005.','B006.','B00y.','B00z.','B00z0','B00z1','B00zz','B01..','B010.','B0100','B010z','B011.','B0110','B0111','B011z','B012.','B013.','B0130','B0131','B013z','B014.','B015.','B016.','B017.','B01y.','B01z.','B02..','B020.','B021.','B022.','B023.','B02y.','B02z.','B03..','B030.','B031.','B03y.','B03z.','B04..','B040.','B041.','B042.','B04y.','B04z.','B05..','B050.','B051.','B0510','B0511','B0512','B0513','B051z','B052.','B053.','B054.','B055.','B0550','B0551','B055z','B056.','B05y.','B05z.','B05z0','B06..','B060.','B0600','B0601','B0602','B060z','B061.','B062.','B0621','B0622','B062z','B063.','B064.','B0640','B0641','B064z','B065.','B066.','B067.','B06y.','B06y0','B06yz','B06z.','B07..','B070.','B071.','B0710','B071z','B072.','B0720','B0721','B072z','B073.','B0730','B0731','B0732','B073z','B074.','B07y.','B07z.','B08..','B080.','B081.','B082.','B083.','B084.','B08y.','B08z.','B0z..','B0z0.','B0z1.','B0zy.','B0zz.','B1...','B10..','B100.','B101.','B102.','B103.','B104.','B105.','B106.','B10y.','B10z.','B11..','B110.','B1100','B1101','B110z','B111.','B1110','B1111','B111z','B112.','B113.','B114.','B115.','B116.','B117.','B11y.','B11y0','B11y1','B11yz','B11z.','B12..','B120.','B121.','B122.','B123.','B124.','B12y.','B12z.','B13..','B130.','B131.','B132.','B133.','B134.','B135.','B136.','B137.','B138.','B13y.','B13z.','B14..','B140.','B141.','B142.','B143.','B14y.','B14z.','B15..','B150.','B1500','B1501','B1503','B150z','B151.','B1510','B1511','B1512','B1513','B1514','B151z','B152.','B15z.','B16..','B160.','B161.','B1610','B1611','B1612','B1613','B161z','B162.','B163.','B16y.','B16z.','B17..','B170.','B171.','B172.','B173.','B174.','B175.','B17y.','B17y0','B17yz','B17z.','B18..','B180.','B1800','B1801','B1802','B180z','B182.','B18y.','B18y0','B18y1','B18y2','B18y3','B18y4','B18y5','B18y6','B18yz','B18z.','B1z..','B1z0.','B1z2.','B1zy.','B1zz.','B2...','B20..','B200.','B2000','B2001','B2002','B2003','B200z','B201.','B2010','B2011','B2012','B2013','B201z','B202.','B203.','B204.','B205.','B206.','B20y.','B20z.','B21..','B210.','B211.','B212.','B213.','B2130','B2131','B2132','B2133','B213z','B214.','B21y.','B21z.','B24..','B240.','B241.','B2410','B2411','B2412','B2413','B241z','B242.','B243.','B24y.','B24z.','B25..','B26..','B2z..','B2z0.','B3...','B30..','B300.','B3000','B3001','B3002','B3003','B3004','B3005','B3006','B3007','B3008','B3009','B300A','B300B','B300C','B300z','B301.','B302.','B3020','B3021','B3022','B302z','B303.','B3030','B3031','B3032','B3033','B3034','B3035','B303z','B304.','B3040','B3041','B3042','B3043','B3044','B304z','B305.','B3050','B3051','B3052','B3053','B3054','B3055','B3056','B3057','B3058','B3059','B305A','B305B','B305C','B305D','B305z','B306.','B3060','B3061','B3062','B3063','B3064','B306z','B307.','B3070','B3071','B3072','B307z','B308.','B3080','B3081','B3082','B3083','B3084','B3085','B3086','B3087','B3088','B3089','B308A','B308B','B308C','B308D','B308z','B309.','B30z.','B31..','B310.','B3100','B3101','B3102','B3103','B3104','B3105','B310z','B311.','B3110','B3111','B3112','B3113','B3114','B3115','B311z','B312.','B3120','B3121','B3122','B3123','B3124','B3125','B3126','B312z','B313.','B3130','B3131','B3132','B3133','B313z','B314.','B3140','B3141','B314z','B315.','B3150','B3151','B3152','B3153','B315z','B316.','B317.','B31y.','B31z.','B31z0','B32..','B320.','B321.','B322.','B3220','B3221','B322z','B323.','B3230','B3231','B3232','B3233','B3234','B3235','B323z','B324.','B3240','B3241','B324z','B325.','B3250','B3251','B3252','B3253','B3254','B3255','B3256','B325z','B326.','B3260','B3261','B3262','B3263','B3264','B3265','B326z','B327.','B3270','B3271','B3272','B3273','B3274','B3275','B3276','B3277','B3278','B3279','B327z','B32y.','B32y0','B32z.','B34..','B340.','B3400','B3401','B340z','B341.','B342.','B343.','B344.','B345.','B346.','B347.','B34y.','B34y0','B34yz','B34z.','B35..','B350.','B3500','B3501','B350z','B35z.','B35z0','B35zz','B3y..','B3z..','B4...','B40..','B41..','B410.','B4100','B4101','B410z','B411.','B412.','B41y.','B41y0','B41y1','B41yz','B41z.','B42..','B420.','B43..','B430.','B4300','B4301','B4302','B4303','B430z','B431.','B4310','B431z','B432.','B43y.','B43z.','B44..','B440.','B441.','B442.','B443.','B444.','B44y.','B44z.','B45..','B450.','B4500','B4501','B450z','B451.','B4510','B451z','B452.','B453.','B454.','B45y.','B45y0','B45z.','B46..','B47..','B470.','B4700','B4701','B470z','B471.','B47z.','B48..','B480.','B481.','B482.','B483.','B484.','B485.','B486.','B487.','B48y.','B48y0','B48y1','B48y2','B48yz','B48z.','B49..','B490.','B491.','B492.','B493.','B494.','B495.','B496.','B497.','B49y.','B49y0','B49z.','B4A..','B4A0.','B4A00','B4A1.','B4A10','B4A11','B4A1z','B4A2.','B4A3.','B4A4.','B4Ay.','B4Ay0','B4Az.','B4y..','B4z..','B5...','B50..','B500.','B5000','B5001','B5002','B5003','B500z','B501.','B5010','B5011','B501z','B503.','B504.','B505.','B506.','B507.','B5070','B5071','B507z','B508.','B50y.','B50z.','B510.','B5100','B5101','B5102','B5103','B5104','B5105','B510z','B511.','B512.','B5120','B5121','B512z','B513.','B514.','B515.','B5150','B5151','B515z','B516.','B517.','B5170','B5171','B5172','B5173','B517z','B51y.','B51y0','B51y1','B51yz','B51z.','B52..','B520.','B5200','B520z','B521.','B5210','B5211','B5212','B521z','B522.','B523.','B5230','B5231','B5232','B523z','B524.','B5240','B5241','B5242','B5243','B5244','B5245','B5246','B525.','B52y.','B52z.','B53..','B54..','B540.','B5400','B5401','B540z','B541.','B542.','B5420','B5421','B542z','B543.','B544.','B545.','B5450','B5451','B5452','B545z','B54y.','B54z.','B55..','B550.','B5500','B5501','B5502','B5503','B5504','B5505','B550z','B551.','B5510','B5511','B5512','B551z','B552.','B553.','B5530','B5531','B5532','B553z','B554.','B555.','B55y.','B55y0','B55y1','B55y2','B55yz','B55z.','B56..','B560.','B5600','B5601','B5602','B5603','B5604','B5605','B5606','B5607','B5608','B5609','B560z','B561.','B5610','B5611','B5612','B5613','B5614','B5615','B5616','B5617','B5618','B5619','B561z','B562.','B5620','B5621','B5622','B5623','B5624','B562z','B563.','B5630','B5631','B5632','B5633','B563z','B564.','B5640','B5641','B5642','B564z','B565.','B5650','B5651','B5652','B5653','B5654','B565z','B56y.','B56z.','B57..','B570.','B571.','B572.','B573.','B574.','B5740','B5741','B5742','B574z','B575.','B5750','B5751','B575z','B576.','B5760','B5761','B576z','B577.','B57y.','B57z.','B58..','B580.','B581.','B5810','B5811','B5812','B581z','B582.','B5820','B5821','B5822','B5823','B5824','B5825','B5826','B582z','B583.','B5830','B5831','B583z','B584.','B585.','B586.','B587.','B58y0','B58y1','B58y2','B58y3','B58y4','B58y5','B58y6','B58y7','B58y8','B58yz','B59..','B590.','B591.','B592.','B59z.','B5y..','B5z..','B6z0.','BB02.','BB04.','BB07.','BB08.','BB09.','BB0A.','BB14.','BB53.','BB5B1','BB5B3','BB5B5','BB5B6','BB5C.','BB5C1','BB5Cz','BB5D1','BB5D3','BB5D5','BB5D7','BB5D8','BB5F.','BB5P.','BB5Q.','BB5R.','BB5R0','BB5R1','BB5R3','BB5R4','BB5R5','BB5R7','BB5R9','BB5RA','BB5Rz','BB5T1','BB5U2','BB5V1','BB5V3','BB5V5','BB5V7','BB5W1','BB5X1','BB5Y.','BB5a0','BB5b.','BB5c2','BB5d1','BB5f1','BB5f2','BB5f3','BB5f6','BB5f7','BB5h1','BB5j2','BB5j5','BB5y1','BB5y2','BB621','BB691','BB6A1','BB71.','BB801','BB812','BB815','BB818','BB81B','BB81E','BB81H','BB821','BB83.','BB84.','BB850','BB851','BB85z','BB91.','BB93.','BB94.','BB9B.','BB9C.','BB9D.','BB9F.','BB9G.','BB9H.','BB9J.','BB9K.','BB9L.','BB9M.','BBA2.','BBB0.','BBB2.','BBB3.','BBB4.','BBB5.','BBB61','BBC4.','BBC61','BBCA.','BBCC1','BBD1.','BBD8.','BBDA.','BBDB.','BBE..','BBE1.','BBE2.','BBE4.','BBEC.','BBEE.','BBEF.','BBEG.','BBEH.','BBEM.','BBEP.','BBEQ.','BBER.','BBES.','BBET.','BBF1.','BBF3.','BBF4.','BBF5.','BBF6.','BBG1.','BBG3.','BBG5.','BBG7.','BBG8.','BBGF.','BBGM.','BBGP.','BBH1.','BBJ1.','BBJ3.','BBJ5.','BBJ6.','BBJ7.','BBJ8.','BBJB1','BBJH.','BBK02','BBK04','BBK11','BBK2.','BBK21','BBK2z','BBK31','BBK32','BBK33','BBK36','BBK37','BBL0.','BBL4.','BBL5.','BBL6.','BBL72','BBL73','BBL8.','BBL9.','BBLA.','BBLC1','BBLD.','BBLE.','BBLJ.','BBM01','BBM9.','BBN2.','BBN3.','BBN4.','BBN5.','BBP1.','BBP3.','BBP5.','BBP7.','BBPX.','BBQ0.','BBQ1.','BBQ10','BBQ11','BBQ1z','BBQ3.','BBQ4.','BBQ5.','BBQ73','BBQ74','BBQ75','BBQ9.','BBQA1','BBR2.','BBR3.','BBR4.','BBS2.','BBT1.','BBT5.','BBT71','BBTA.','BBTD2','BBU1.','BBV1.','BBV2.','BBV3.','BBV4.','BBV5.','BBV6.','BBV9.','BBVA.','BBVz.','BBW4.','BBW6.','BBW8.','BBW9.','BBX1.','BBX3.','BBY0.','BBZ2.','BBZC.','BBZG.','BBZN.','BBa3.','BBa5.','BBb0.','BBb1.','BBb2.','BBb6.','BBbH.','BBbJ.','BBbK.','BBbL.','BBbM.','BBbN.','BBbP.','BBbQ.','BBbR.','BBbS.','BBbT.','BBbU.','BBbV.','BBbW.','BBbX.','BBc..','BBc01','BBc1.','BBc2.','BBc3.','BBc4.','BBc5.','BBc9.','BBc90','BBc91','BBc9z','BBcA.','BBcB.','BBcC.','BBcD.','BBcz.','BBd2.','BBdB.','BBe2.','BBe7.','BBf1.','BBf2.','BBmG.','Byu1.','Byu10','Byu11','Byu12','Byu13','Byu2.','Byu24','Byu25','Byu3.','Byu30','Byu31','Byu32','Byu33','Byu52','Byu53','Byu54','Byu55','Byu56','Byu57','Byu58','Byu59','Byu5A','Byu5B','Byu6.','Byu7.','Byu70','Byu71','Byu72','Byu73','Byu8.','Byu80','Byu81','Byu82','Byu9.','Byu90','ByuA.','ByuA0','ByuA1','ByuA2','ByuA3','ByuB.','ByuB0','ByuB1','ByuC.','ByuC0','ByuC1','ByuC2','ByuC3','ByuC4','ByuC5','ByuC6','ByuC7','ByuC8','C1z2.','F373.','F3811','F3962','X00eS','X309C','X309D','X40B6','X40B9','X40On','X507N','X77nP','X77nQ','X77nR','X77nU','X77ng','X77nj','X77nk','X77nu','X77nv','X77nw','X77ny','X77o1','X77o2','X77o7','X77oH','X77oI','X77oJ','X77oK','X77oL','X77oT','X77oU','X77oV','X77oW','X77oX','X77ob','X77of','X77ok','X77ol','X77om','X77on','X77ou','X77ov','X77p3','X77p6','X77pA','X77pB','X77pM','X77pN','X77pR','X77pS','X77pT','X77pW','X77pZ','X77pa','X77pb','X77pc','X77pv','X77pw','X77px','X77py','X77q4','X78Gj','X78H1','X78H6','X78HC','X78HI','X78HO','X78HT','X78Hf','X78Hj','X78Hp','X78Hw','X78Hz','X78I5','X78IA','X78IG','X78IL','X78IR','X78IW','X78Ib','X78Ig','X78In','X78Is','X78Iy','X78J3','X78J8','X78JC','X78JJ','X78JO','X78JS','X78JV','X78Jp','X78Jt','X78Jw','X78K0','X78LA','X78LV','X78LZ','X78Ld','X78Li','X78Ll','X78Lo','X78Lr','X78Lu','X78Lx','X78M7','X78M9','X78MH','X78MM','X78MR','X78MW','X78Mb','X78Mg','X78Mm','X78Mr','X78Mw','X78N1','X78N6','X78NB','X78NC','X78NG','X78NH','X78NL','X78OK','X78OP','X78OW','X78OX','X78Oz','X78P0','X78PC','X78PX','X78Pf','X78Pg','X78Pq','X78Ql','X78T8','X78TC','X78TF','X78TG','X78U0','X78VQ','X78VS','X78VT','X78Vi','X78Vj','X78Vm','X78WF','X78WM','X78WN','X78WO','X78WP','X78WQ','X78WR','X78WS','X78WT','X78Wh','X78Wi','X78Wj','X78Wk','X78Wl','X78Wn','X78Wo','X78Wy','X78Wz','X78X1','X78X8','X78X9','X78XB','X78XD','X78XH','X78XN','X78XO','X78Xf','X78Xg','X78Xh','X78Xj','X78Xq','X78Xw','X78Xx','X78Xy','X78Y1','X78Y6','X78YK','X78YP','X78YR','X78Yb','X78Yx','X78Yy','X78Yz','X78Z0','X78ZS','X78Zc','X78Zq','X78a4','X78aB','X78aY','X78ac','X78af','X78ag','X78ah','X78ai','X78aj','X78ap','X78as','X78av','X78b0','X78b1','X78b2','X78b3','X78b8','X78b9','X78bA','X78bB','X78bM','X78bN','X78bU','X78bV','X78bc','X78bj','X78bk','X78bl','X78bm','X78bw','X78cP','X78cQ','X78cR','X78cS','X78cT','X78ca','X78ci','X78dW','X78e9','X78eB','X78eE','X78eH','X78eL','X78eV','X78eY','X78ef','X78eg','X78eh','X78ej','X78ek','X78es','X78fC','X78fH','X78fI','X78fK','X78fN','X78fO','X78g0','X78g1','X78g2','X78g3','X78gA','X78gK','X78gL','X78gM','X78gN','X78gO','X78gQ','X78gS','X78gY','X78ga','X78gb','X78gc','X78gd','X78gp','X78gq','X78gr','X78h0','X78h1','X78h7','X78hq','X78i1','X78i2','X78iC','X78id','X78if','X78it','X78iu','X78j1','X78j2','X78j3','X78j4','X78j7','X78jJ','X78je','X78ji','X78jy','X78kS','X78kT','X78kU','X78kV','X78kX','X78kY','X78kZ','X78ka','X78kb','X78kc','X78kd','X78ke','X78kf','X78kg','X78kh','X78kk','X78kl','X78kn','X78kp','X78kq','X78kr','X78ks','X78kv','X78kw','X78kx','X78ky','X78kz','X78l0','X78l1','X78l2','X78l3','X78l4','X78l5','X78l7','X78l8','X78lA','X78lB','X78qc','XC0dw','XE1Kp','XE1vP','XE1vQ','XE1vR','XE1vS','XE1vT','XE1vU','XE1vV','XE1vW','XE1vX','XE1vY','XE1vZ','XE1va','XE1vd','XE1ve','XE1vf','XE1vg','XE1vi','XE1vj','XE1vk','XE1vl','XE1vm','XE1vn','XE1wT','XE1wX','XE1wY','XE1wZ','XE1wa','XE1wb','XE1wc','XE1wg','XE1wj','XE1wl','XE1wp','XE1wr','XE1wt','XE1wv','XE1wx','XE1wz','XE1x1','XE1x3','XE1x5','XE1x7','XE1x9','XE1xB','XE1xD','XE1xF','XE1xH','XE1xJ','XE1xL','XE1xN','XE1xP','XE1xR','XE1xT','XE1xV','XE1xX','XE1xZ','XE1xb','XE1xd','XE1xf','XE1xh','XE1xj','XE1xl','XE1xp','XE1xr','XE1xt','XE1xv','XE1xx','XE1xz','XE1y1','XE1y3','XE1y5','XE1y7','XE1y9','XE1yB','XE1yD','XE1yT','XE1yV','XE1yX','XE1yZ','XE1yb','XE1yd','XE1yf','XE1yh','XE1yj','XE1yl','XE1yn','XE1yp','XE1yr','XE1z9','XE1zB','XE1zD','XE1zF','XE1zH','XE1zJ','XE1zL','XE1zN','XE1zP','XE1zR','XE1zT','XE1zV','XE1zX','XE1zZ','XE1zb','XE1zd','XE1zf','XE1zh','XE1zj','XE1zl','XE1zn','XE1zp','XE1zr','XE1zt','XE1zv','XE205','XE207','XE209','XE20B','XE20D','XE20F','XE20X','XE2rk','XE2vN','XE2vO','XE2vP','XE2vQ','XE2vR','XE2vS','XE2vT','XE2vj','XE2xB','XM00E','XM00F','XM0Ac','XM0Ad','XM0B6','XM0pZ','XM0pb','XM0pq','XM0ps','XM0pv','XM1F6','XM1F7','XM1FE','XM1FG','XM1FI','XM1FO','XM1MM','XM1Oc','XM1Od','XM1Oe','XM1Of','XM1Oi','XM1P4','XM1Pr','XM1Ps','XM1QO','XSA0M','XSHw5','XSHw6','XSHw7','XSHw8','Xa059','Xa05A','Xa0D7','Xa0D9','Xa0DF','Xa0DG','Xa0DO','Xa0DP','Xa0DQ','Xa0Di','Xa0Dj','Xa0Dp','Xa0Dq','Xa0Dr','Xa0Ds','Xa0EY','Xa0Ei','Xa0Eq','Xa0G9','Xa0GA','Xa0GC','Xa0GN','Xa0Ge','Xa0KC','Xa0LD','Xa0R4','Xa0RU','Xa0WG','Xa0WH','Xa0aG','Xa0aO','Xa0aS','Xa0ay','Xa0bJ','Xa0bK','Xa0bL','Xa0bM','Xa0bQ','Xa0bT','Xa0bU','Xa0bV','Xa0bb','Xa0hk','Xa0hl','Xa0iA','Xa0iB','Xa0ik','Xa1aS','Xa1nX','Xa1nZ','Xa1na','Xa1nb','Xa1nc','Xa1ne','Xa1oQ','Xa34F','Xa34H','Xa36T','Xa36r','Xa39z','Xa3A4','Xa3A5','Xa3A6','Xa3A7','Xa3A8','Xa3A9','Xa3AA','Xa3AB','Xa3AC','Xa3AD','Xa3AE','Xa3AF','Xa3AG','Xa3AH','Xa3AI','Xa3AJ','Xa3AK','Xa3BF','Xa3BG','Xa3BH','Xa3BI','Xa3BL','Xa3BM','Xa3BN','Xa3BX','Xa3BZ','Xa3Ba','Xa3Bb','Xa3Bc','Xa3Bd','Xa3eF','Xa3eG','Xa3eH','Xa3eI','Xa3eJ','Xa3eK','Xa3eL','Xa3eM','Xa3eN','Xa3eO','Xa3eP','Xa3eQ','Xa3eR','Xa3eS','Xa3eT','Xa3eU','Xa3rj','Xa7n9','Xa7o3','Xa84V','Xa97p','Xa97q','Xa97r','Xa97s','Xa97t','Xa97u','Xa97v','Xa97w','Xa97x','Xa97y','Xa97z','Xa980','Xa981','Xa982','Xa983','Xa98L','Xa98P','Xa98Q','Xa98Y','Xa98Z','Xa98c','Xa98e','Xa98k','Xa98m','Xa98o','Xa98r','Xa98u','Xa98x','Xa98y','Xa98z','Xa993','Xa997','Xa998','Xa999','Xa99A','Xa99D','Xa99F','Xa99H','Xa99K','Xa99L','Xa99S','Xa99V','Xa99a','Xa99e','Xa99f','Xa99h','Xa99p','Xa99r','Xa99v','Xa99y','Xa9A0','Xa9A1','Xa9A8','Xa9A9','Xa9AI','Xa9AJ','Xa9AQ','Xa9AV','Xa9Aa','Xa9EA','Xa9Jc','Xa9Je','Xa9Jg','Xa9Ji','Xa9Jk','Xa9Jm','Xa9Jo','XaA0C','XaAtd','XaB1b','XaB1e','XaB1g','XaB1h','XaB1i','XaB1p','XaB8h','XaB9x','XaBA5','XaBAn','XaBAo','XaBAt','XaBAu','XaBB1','XaBB5','XaBBF','XaBDS','XaBLv','XaBmX','XaC0y','XaC1Q','XaCIv','XaCJ1','XaCJU','XaDbr','XaDc5','XaDc6','XaDc7','XaDc8','XaDc9','XaE6L','XaEGU','XaEY9','XaEfj','XaF1E','XaF26','XaFr4','XaFr5','XaFr6','XaFr8','XaFrD','XaFrE','XaFrF','XaFrG','XaFrH','XaFrI','XaFrJ','XaFrK','XaFrL','XaFrM','XaFrN','XaFrQ','XaFrR','XaFrT','XaFrc','XaFrd','XaFrf','XaFrg','XaFrh','XaFri','XaFrj','XaFrk','XaFrl','XaFrm','XaFrn','XaFro','XaFrp','XaFrq','XaFrr','XaFrs','XaFrt','XaFru','XaFrv','XaFrx','XaFry','XaFrz','XaFsw','XaFzu','XaIJA','XaIma','XaImb','XaImc','XaImd','XaIn5','XaIph','XaJM3','XaJU6','XaKHe','XaKI4','XaKI6','XaKI8','XaKWz','XaMeL','XaN5C','XaOqX','XaOrB','XaOrV','XaX42','XaX43','XaX44','XaXQk','XaYeq','XaZzi','XaabR','Xaafk','XacIU','XacIV','XacIW','XacIX','XacIY','XacIZ','XacIa','XacIb','XacId','XacIe','XacIf','XacY5','Y3491','Y3656','ZV676','ZV677','ZV679','ZV67A','ZV67B') AND 1=1
            GROUP BY Patient_ID
            ), bone_marrow_transplant AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('7K1Q.','7K1Q0','7K1Q1','7K1Qy','7K1Qz','X20Bc','X20Bd','X20Be','X20Bf','X20Bg','X20Bh','X20Bi','X20Fz','X20G0','X20G1','X20G3','Xa0fK','Xa3wp','Xa8Ry','XaKK4','XaKKM','XaM83','XaM84','XaM85','XaMuA','XaMuB','XaMuC','XaPt6') AND 1=1
            GROUP BY Patient_ID
            ), chemo_radio_therapy AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('5135','514..','5141','5142','5143','5144','5145','5146','5147','5148','5149','514Z.','515..','5151','5152','5153','5154','515Z.','56B5.','591..','5911','5912','5913','5914','5915','5916','5917','5918','591Z.','592..','5921','5922','5923','5924','592Z.','593..','5931','5932','5933','5934','593Z.','594..','5941','5942','5943','5944','5945','5946','594Z.','595..','5951','5952','5953','595Z.','596..','5961','5962','5963','596Z.','597..','5971','5972','5973','5974','5975','597Z.','59Z..','5A...','5A1..','5A11.','5A12.','5A13.','5A14.','5A15.','5A16.','5A17.','5A1Z.','5A2..','5A21.','5A22.','5A23.','5A24.','5A25.','5A26.','5A27.','5A28.','5A2Z.','5A3..','5A31.','5A32.','5A33.','5A3Z.','5A4..','5A41.','5A42.','5A43.','5A44.','5A45.','5A46.','5A47.','5A48.','5A4Z.','5A5..','5A51.','5A52.','5A53.','5A54.','5A55.','5A56.','5A57.','5A58.','5A59.','5A5A.','5A5B.','5A5Z.','5A6..','5A61.','5A62.','5A63.','5A64.','5A65.','5A66.','5A67.','5A6Z.','5A7..','5A71.','5A72.','5A73.','5A74.','5A75.','5A76.','5A77.','5A7Z.','5A8..','5A81.','5A82.','5A83.','5A8Z.','5AZ..','65NZ.','70462','70522','71011','72201','72444','72722','7D034','7D154','7E0C0','7H2C0','7M0P.','7M0P0','7M0P1','7M0P2','7M0Py','7M0Pz','7M371','863..','863Z.','8BA5.','8BAD0','8BAD1','8H2G.','8H3L.','8H67.','8HB5.','8HB7.','8J...','8J0..','8J1..','9N1yC','D2013','SL07.','SL070','SL073','SL07z','TA32.','TB121','TJ07.','TJ070','TJ071','TJ072','TJ073','TJ074','TJ07z','TJ310','TJ311','TJ312','TJ313','TJ314','TJ315','TJ316','TJ317','TJ318','TJ319','TJ31A','TJ31B','TJ31C','TJ31D','TJ31E','TJ31F','TJ31G','TJ31H','TJ31J','TJ31K','TJ31L','TJ31M','TJ31N','TJ31P','TJ31z','U6031','U6032','U6033','U6132','Ub0w0','Ub0w2','Ub0w4','Ub0w5','Ub0w6','Ub0w7','Ub0w8','Ub0w9','Ub0wA','Ub0wB','Ub0wC','Ub0wD','Ub0wE','Ub0wF','Ub0wG','Ub0wH','Ub0wI','Ub0wJ','Ub0wK','Ub0wL','Ub0wM','Ub0wN','Ub0wO','Ub0wP','Ub0wQ','Ub0wR','Ub0wT','Ub0wU','Ub0wV','Ub0wW','Ub0wX','Ub0wY','Ub0wZ','Ub0wa','Ub0wb','Ub0wc','Ub0wd','Ub0we','Ub0wf','Ub0wg','Ub0wh','Ub0wi','Ub0wj','Ub0wk','Ub0wl','Ub0wm','Ub0wn','Ub0wo','Ub0wp','Ub0wq','Ub0wr','Ub0ws','Ub0wt','Ub0wu','Ub0wv','Ub0ww','Ub0wx','Ub0wy','Ub0wz','Ub0x0','Ub0x4','Ub0x5','Ub0x6','Ub0x7','Ub0x8','Ub0x9','Ub0xA','Ub0xB','Ub0xC','Ub0xD','Ub0xE','Ub0xF','Ub0xG','Ub0xH','Ub0xI','Ub0xJ','Ub0xK','Ub0xL','Ub0xM','Ub0xN','Ub0xO','Ub1Pe','X00Te','X00U8','X00UQ','X00X9','X00Xi','X00Y8','X20by','X71bL','XC0gO','XE0Jb','XE0Jc','XE0Je','XE0hv','XE14D','XE1Rx','XE1Sk','XE2r3','XE2rh','XS90X','Xa3yl','Xa3yn','Xa4sx','Xa4sy','Xa4sz','Xa7mv','Xa8SI','Xa97L','XaC0F','XaC0G','XaC0H','XaC0n','XaDn1','XaDn2','XaDok','XaDol','XaDor','XaDot','XaDp8','XaDzO','XaECT','XaFBN','XaFBO','XaFBP','XaFz7','XaI8k','XaIR9','XaIky','XaIkz','XaIl6','XaImG','XaIme','XaImf','XaIpD','XaIpE','XaIpe','XaJr8','XaKwV','XaL5K','XaLbh','XaLdq','XaLdr','XaLuJ','XaLyT','XaLyX','XaLzs','XaLzt','XaLzu','XaLzv','XaLzw','XaM2B','XaM2C','XaM2E','XaM2F','XaM2G','XaM2H','XaM2M','XaM2N','XaM2O','XaM2P','XaM2Q','XaM2R','XaM2S','XaM2T','XaM2U','XaM2V','XaM2W','XaM2X','XaM2Y','XaM2Z','XaM2a','XaM49','XaM4A','XaM4B','XaM4C','XaM4D','XaM4E','XaM4F','XaM4G','XaM4H','XaM4I','XaM4J','XaM4L','XaM4w','XaMAv','XaMB1','XaMOH','XaMlE','XaMtr','XaMuE','XaMv7','XaNS5','XaNS6','XaNS7','XaNS8','XaNSA','XaNSB','XaNSC','XaNSD','XaNSR','XaPt9','XaPuI','XaPuJ','XaPuL','XaPuM','XaPuN','XaPuO','XaPuP','XaPuQ','XaPuR','XaPuS','XaPuT','XaPuU','XaPuV','XaPuW','XaPuX','XaPve','XaPvf','XaPvg','XaPvh','XaPvi','XaPvj','XaPvk','XaPvl','XaPvm','XaPvn','XaPw8','XaVwB','XaZD3','XaZWZ','Xaaqq','Xaaw6','Xaawm','Y035e','Y035f','Y036a','Y036b','Y036c','Y036d','Y036e','Y036f','Y037a','Y037b','ZV073','ZV580','ZV581','ZV588','ZV661','ZV672','ZV678','ZV679','ZV6B1','ZVu0C','ZVu0D','ZVu3L') AND 1=1
            GROUP BY Patient_ID
            ), chronic_liver_disease AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('7609.','7609.','76093','76094','7609y','7609z','760C3','760C5','760F3','760F4','760J4','7800.','78000','78001','78001','78002','7800y','7800z','78052','A704.','A7040','A704z','A706.','A7071','A7072','AyuB1','AyuB2','AyuB3','C3500','C3500','F10y0','G85..','G850.','G851.','G852.','G8520','G8521','G852z','G857.','Gyu94','J6000','J6010','J61..','J610.','J611.','J612.','J613.','J614.','J6140','J6141','J6141','J6142','J6143','J614y','J614z','J615.','J6150','J6151','J6152','J6153','J6154','J6155','J6155','J6156','J6157','J6158','J6159','J615A','J615B','J615D','J615F','J615G','J615H','J615y','J615y','J615z','J616.','J6160','J6161','J6162','J616z','J617.','J61y.','J61y0','J61y3','J61yz','J61z.','J62..','J623.','J624.','J62z.','J630.','J6353','J6354','J6355','J6356','J63A.','J6617','Jyu71','PB61.','PB61.','PB610','PB610','PB611','PB614','PB615','PB615','PB616','PB61z','PB635','Q48yz','SP086','SP142','SP143','X2063','X20Uu','X20Uu','X20Uv','X20Zz','X306h','X306i','X306j','X306k','X306l','X306r','X3071','X3072','X3073','X3076','X3077','X3078','X3079','X307A','X307C','X307G','X307I','X307L','X307M','X307M','X307N','X307N','X307O','X307O','X307P','X307P','X307Q','X307R','X307R','X307S','X307T','X307U','X307V','X307W','X307W','X307X','X307Y','X307Z','X307a','X307b','X307c','X307x','X307y','X307z','X3085','X7847','X7847','X7848','X7848','XE0CP','XE0CP','XE0b4','XE0b4','XE0b5','XE0b5','XE0b6','XE0b7','XE0b7','XE0b8','XE0b8','XE0bA','XE0bA','XE0bC','XE0dD','XE0dF','XE0dH','XE0dJ','XE2up','Xa9C7','Xa9C7','XaBE3','XaBM6','XaC1d','XaE6u','XaJTk','XaJxp','XaLdJ','XaLde','XaLdf','XaMMe','XaMuG','XaMuH','XaMuI','XaPLW','XaPLW','XaREa','XaXi9','XaYbp','ZV427','ZV7C0') AND 1=1
            GROUP BY Patient_ID
            ), neurological_condition AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('23E5.','663K.','7450','7450y','7450z','A114.','A115.','A7899','AD52.','C370.','C370.','C3700','C3701','C3701','C3702','C3703','C370z','H0614','H3...','H3...','H31..','H310.','H3100','H310z','H311.','H3110','H311z','H3121','H3122','H312z','H313.','H31y.','H31y0','H31y1','H31yz','H31z.','H32..','H320.','H3200','H3201','H3202','H3203','H320z','H321.','H322.','H32y.','H32y0','H32y1','H32y2','H32y2','H32yz','H32z.','H34..','H340.','H341.','H34z.','H35..','H35..','H350.','H351.','H352.','H3520','H3521','H352z','H353.','H354.','H355.','H356.','H357.','H35y.','H35y0','H35y1','H35y2','H35y3','H35y4','H35y5','H35y6','H35y7','H35y8','H35yz','H35z.','H35z0','H35z1','H3y..','H3y..','H3y0.','H3y1.','H3z..','H3z..','H4...','H40..','H41..','H41z.','H42..','H420.','H421.','H422.','H423.','H42z.','H43..','H430.','H431.','H432.','H433.','H434.','H435.','H43z.','H44..','H440.','H441.','H44z.','H45..','H450.','H460.','H4601','H460z','H464.','H4640','H4641','H4642','H464z','H46z0','H47..','H4y0.','H4y00','H4y0z','H4y1.','H4y10','H4y1z','H4y2.','H4y20','H4y21','H52y1','H5302','H5410','H55..','H561.','H563.','H5631','H563z','H56y0','H571.','H572.','H57y0','H57y1','H57y2','H57y3','H57y4','H581.','H582.','H583.','H591.','Hy02.','Hyu30','Hyu31','Hyu40','Hyu41','Hyu43','Hyu47','Hyu50','K260.','L380.','N0421','N0421','N04y0','P851.','P861.','PK35.','Q317.','Q3170','Q3171','Q3172','Q317z','Qyu36','SP130','SP131','X00s1','X00s2','X00s3','X00s4','X100V','X100l','X100m','X100n','X100o','X100p','X100q','X100r','X100t','X101U','X101U','X101X','X101Z','X101a','X101b','X101c','X101d','X101e','X101i','X101j','X101k','X101l','X101m','X101n','X101o','X101p','X101q','X101r','X1025','X1026','X1027','X1028','X102B','X102H','X102J','X102K','X102L','X102M','X102N','X102O','X102P','X102Q','X102R','X102S','X102T','X102U','X102j','X102j','X102k','X102u','X102v','X102v','X102w','X102x','X102y','X102z','X1030','X1031','X1032','X1033','X1034','X1035','X1038','X103A','X103G','X103W','X103X','X103Y','X103Y','X103Z','X103a','X103b','X103c','X103d','X103e','X103f','X103h','X103i','X103j','X103k','X103l','X103m','X103n','X103o','X103p','X103q','X103r','X103s','X103u','X103v','X103w','X103x','X1043','X1044','X1045','X1046','X1047','X1048','X1049','X104B','X104C','X309R','X701k','X701k','X70Eg','X70RL','XE0YM','XE0YN','XE0YO','XE0YO','XE0YP','XE0YY','XE0Ya','XE0Ya','XE0Yb','XE0Yb','XE0ZN','XE0ZV','XE0ZX','XE0ZZ','XE0Zf','XE0Zh','XE0Zr','XE1NO','XE1ep','XE2Pp','XE2Pp','XM1Qc','XSC3p','Xa08A','Xa0BC','Xa0Qe','Xa0Qi','Xa0Qj','Xa0Tw','Xa35l','Xa9Bw','Xa9Bw','Xa9Bx','XaBDb','XaBDb','XaEIV','XaEIW','XaEIY','XaEKI','XaIND','XaIQT','XaIQg','XaIQg','XaIQh','XaIRO','XaIUt','XaIes','XaIes','XaIet','XaIu7','XaIu8','XaJ4k','XaJFu','XaJYf','XaJlS','XaJlT','XaJlU','XaJlV','XaJlW','XaJlY','XaK8Q','XaK8R','XaK8S','XaK8U','XaKv8','XaKv9','XaKzy','XaL2O','XaLcH','XaLqj','XaMzI','XaN4a','XaO5l','XaO5m','XaOYV','XaPZH','XaPZH','XaPls','XaPls','XaPlu','XaPlu','XaPzu','XaQvd','XaRCG','XaRCH','XaREX','XaREZ','XaREa','XaREd','XaW9D','XaXCa','XaXCb','XaXi9','XaXlE','XaXlF','XaXlJ','XaXnt','XaXzy','XaY05','XaY0w','XaYR1','XaYZO','XaYbA','XaYby','XaYuZ','XaZ6U','XaZ6U','XaZ8t','XaZd1','XaZee','XaZoz','XaZp7','XaZp8','XaZr7','Xaa7C','Xaam4','XaavA','Xabud','Xac33','Xac8s','XafhZ','Xafhe','Xafir','Xafit','Xafiu','Y1f1b','Y1f94','Y1f95','Y2708','Y2710') AND 1=1
            GROUP BY Patient_ID
            ), dialysis AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('23E5.','663K.','7450','7450y','7450z','A114.','A115.','A7899','AD52.','C370.','C370.','C3700','C3701','C3701','C3702','C3703','C370z','H0614','H3...','H3...','H31..','H310.','H3100','H310z','H311.','H3110','H311z','H3121','H3122','H312z','H313.','H31y.','H31y0','H31y1','H31yz','H31z.','H32..','H320.','H3200','H3201','H3202','H3203','H320z','H321.','H322.','H32y.','H32y0','H32y1','H32y2','H32y2','H32yz','H32z.','H34..','H340.','H341.','H34z.','H35..','H35..','H350.','H351.','H352.','H3520','H3521','H352z','H353.','H354.','H355.','H356.','H357.','H35y.','H35y0','H35y1','H35y2','H35y3','H35y4','H35y5','H35y6','H35y7','H35y8','H35yz','H35z.','H35z0','H35z1','H3y..','H3y..','H3y0.','H3y1.','H3z..','H3z..','H4...','H40..','H41..','H41z.','H42..','H420.','H421.','H422.','H423.','H42z.','H43..','H430.','H431.','H432.','H433.','H434.','H435.','H43z.','H44..','H440.','H441.','H44z.','H45..','H450.','H460.','H4601','H460z','H464.','H4640','H4641','H4642','H464z','H46z0','H47..','H4y0.','H4y00','H4y0z','H4y1.','H4y10','H4y1z','H4y2.','H4y20','H4y21','H52y1','H5302','H5410','H55..','H561.','H563.','H5631','H563z','H56y0','H571.','H572.','H57y0','H57y1','H57y2','H57y3','H57y4','H581.','H582.','H583.','H591.','Hy02.','Hyu30','Hyu31','Hyu40','Hyu41','Hyu43','Hyu47','Hyu50','K260.','L380.','N0421','N0421','N04y0','P851.','P861.','PK35.','Q317.','Q3170','Q3171','Q3172','Q317z','Qyu36','SP130','SP131','X00s1','X00s2','X00s3','X00s4','X100V','X100l','X100m','X100n','X100o','X100p','X100q','X100r','X100t','X101U','X101U','X101X','X101Z','X101a','X101b','X101c','X101d','X101e','X101i','X101j','X101k','X101l','X101m','X101n','X101o','X101p','X101q','X101r','X1025','X1026','X1027','X1028','X102B','X102H','X102J','X102K','X102L','X102M','X102N','X102O','X102P','X102Q','X102R','X102S','X102T','X102U','X102j','X102j','X102k','X102u','X102v','X102v','X102w','X102x','X102y','X102z','X1030','X1031','X1032','X1033','X1034','X1035','X1038','X103A','X103G','X103W','X103X','X103Y','X103Y','X103Z','X103a','X103b','X103c','X103d','X103e','X103f','X103h','X103i','X103j','X103k','X103l','X103m','X103n','X103o','X103p','X103q','X103r','X103s','X103u','X103v','X103w','X103x','X1043','X1044','X1045','X1046','X1047','X1048','X1049','X104B','X104C','X309R','X701k','X701k','X70Eg','X70RL','XE0YM','XE0YN','XE0YO','XE0YO','XE0YP','XE0YY','XE0Ya','XE0Ya','XE0Yb','XE0Yb','XE0ZN','XE0ZV','XE0ZX','XE0ZZ','XE0Zf','XE0Zh','XE0Zr','XE1NO','XE1ep','XE2Pp','XE2Pp','XM1Qc','XSC3p','Xa08A','Xa0BC','Xa0Qe','Xa0Qi','Xa0Qj','Xa0Tw','Xa35l','Xa9Bw','Xa9Bw','Xa9Bx','XaBDb','XaBDb','XaEIV','XaEIW','XaEIY','XaEKI','XaIND','XaIQT','XaIQg','XaIQg','XaIQh','XaIRO','XaIUt','XaIes','XaIes','XaIet','XaIu7','XaIu8','XaJ4k','XaJFu','XaJYf','XaJlS','XaJlT','XaJlU','XaJlV','XaJlW','XaJlY','XaK8Q','XaK8R','XaK8S','XaK8U','XaKv8','XaKv9','XaKzy','XaL2O','XaLcH','XaLqj','XaMzI','XaN4a','XaO5l','XaO5m','XaOYV','XaPZH','XaPZH','XaPls','XaPls','XaPlu','XaPlu','XaPzu','XaQvd','XaRCG','XaRCH','XaREX','XaREZ','XaREa','XaREd','XaW9D','XaXCa','XaXCb','XaXi9','XaXlE','XaXlF','XaXlJ','XaXnt','XaXzy','XaY05','XaY0w','XaYR1','XaYZO','XaYbA','XaYby','XaYuZ','XaZ6U','XaZ6U','XaZ8t','XaZd1','XaZee','XaZoz','XaZp7','XaZp8','XaZr7','Xaa7C','Xaam4','XaavA','Xabud','Xac33','Xac8s','XafhZ','Xafhe','Xafir','Xafit','Xafiu','Y1f1b','Y1f94','Y1f95','Y2708','Y2710') AND 1=1
            GROUP BY Patient_ID
            ), organ_transplant AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('14S2.','14S3.','14S8.','14S9.','7450.','7450y','7450z','7800.','78000','78001','78002','7800y','7800z','7830.','78300','78301','78302','78303','78304','7830y','7830z','78312','78420','7900.','79000','79001','7900y','7900z','7901.','79010','79011','79013','79015','7901y','7901z','7B00.','7B000','7B001','7B002','7B00y','7B00z','7B015','8C31.','8HBB.','K0B5.','SP08.','SP080','SP081','SP083','SP084','SP085','SP086','SP08z','TB000','TB001','TB002','X00s1','X00s2','X00s3','X00s4','X200b','X202u','X202v','X202w','X307x','X307y','X307z','X30D2','X30MN','X30MO','X30MP','X30MQ','X30MR','X30MS','X30MT','X30MU','X30MV','X30MW','X30MX','X30MY','X30MZ','X30Ma','X30Mb','X30Mc','X30Md','X30Me','X30Mf','X30Mg','X30Mh','X30Mi','X30NE','X30NN','X78FE','X78FF','XC0CV','XE0Fv','XE1p5','XE1pM','XM0Bl','XSC3p','Xa0HK','Xa0HL','Xa0Pz','Xa2h5','Xa3kB','Xa3x6','Xa9UX','XaDya','XaDyb','XaE9T','XaJJo','XaJJv','XaLcH','XaLda','XaLdb','XaLdc','XaLdd','XaLde','XaLdf','XaM1o','XaM1p','XaM4e','XaM4f','XaM4g','XaM4j','XaM4l','XaMKM','XaMMe','XaMm9','XaMmq','XaMms','XaYR1','XaZWa','XaZYx','XaZe2','XaZe3','XaZe7','XaZkw','XaZl0','Xaa2O','Xaa2Q','Xaat5','Xaat6','Y1602','ZV42.','ZV420','ZV421','ZV422','ZV423','ZV424','ZV425','ZV426','ZV427') AND 1=1
            GROUP BY Patient_ID
            ), dysplenia AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('14N7.','7840.','7840.','7840.','78400','78401','78403','78403','7840y','7840y','7840z','7840z','7841.','7841.','78410','78412','7841y','7841y','7841z','7841z','78421','A8410','D4154','D4154','D4156','D4156','D4157','D4157','G74y6','PK01.','PK06.','PK06.','Ua1JD','X205i','X20BK','X20Fp','XA07k','XE1Mi','XE1Mi','XE1Mi','XM1OF','Xa0hO','Xa0hO','Xa7Ya','Xa7Ya','Xa7Ya','Xa9D7','XaEXw','XaEXw','XaZvR','XaZvR') AND 1=1
            GROUP BY Patient_ID
            ), sickle_cell AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('D106.','D106.','D1060','D1060','D1061','D1061','D1062','D1062','D1063','D1063','D1065','D1065','D106z','D106z','Dyu12','Dyu12','F4221','X20Cw','X20Cx','X20Cx','X30Kx','Xa9Ax','Xa9Ax','XaDvR','XabjN') AND 1=1
            GROUP BY Patient_ID
            ), aplastic_anaemia AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('23E5.','663K.','7450','7450y','7450z','A114.','A115.','A7899','AD52.','C370.','C370.','C3700','C3701','C3701','C3702','C3703','C370z','H0614','H3...','H3...','H31..','H310.','H3100','H310z','H311.','H3110','H311z','H3121','H3122','H312z','H313.','H31y.','H31y0','H31y1','H31yz','H31z.','H32..','H320.','H3200','H3201','H3202','H3203','H320z','H321.','H322.','H32y.','H32y0','H32y1','H32y2','H32y2','H32yz','H32z.','H34..','H340.','H341.','H34z.','H35..','H35..','H350.','H351.','H352.','H3520','H3521','H352z','H353.','H354.','H355.','H356.','H357.','H35y.','H35y0','H35y1','H35y2','H35y3','H35y4','H35y5','H35y6','H35y7','H35y8','H35yz','H35z.','H35z0','H35z1','H3y..','H3y..','H3y0.','H3y1.','H3z..','H3z..','H4...','H40..','H41..','H41z.','H42..','H420.','H421.','H422.','H423.','H42z.','H43..','H430.','H431.','H432.','H433.','H434.','H435.','H43z.','H44..','H440.','H441.','H44z.','H45..','H450.','H460.','H4601','H460z','H464.','H4640','H4641','H4642','H464z','H46z0','H47..','H4y0.','H4y00','H4y0z','H4y1.','H4y10','H4y1z','H4y2.','H4y20','H4y21','H52y1','H5302','H5410','H55..','H561.','H563.','H5631','H563z','H56y0','H571.','H572.','H57y0','H57y1','H57y2','H57y3','H57y4','H581.','H582.','H583.','H591.','Hy02.','Hyu30','Hyu31','Hyu40','Hyu41','Hyu43','Hyu47','Hyu50','K260.','L380.','N0421','N0421','N04y0','P851.','P861.','PK35.','Q317.','Q3170','Q3171','Q3172','Q317z','Qyu36','SP130','SP131','X00s1','X00s2','X00s3','X00s4','X100V','X100l','X100m','X100n','X100o','X100p','X100q','X100r','X100t','X101U','X101U','X101X','X101Z','X101a','X101b','X101c','X101d','X101e','X101i','X101j','X101k','X101l','X101m','X101n','X101o','X101p','X101q','X101r','X1025','X1026','X1027','X1028','X102B','X102H','X102J','X102K','X102L','X102M','X102N','X102O','X102P','X102Q','X102R','X102S','X102T','X102U','X102j','X102j','X102k','X102u','X102v','X102v','X102w','X102x','X102y','X102z','X1030','X1031','X1032','X1033','X1034','X1035','X1038','X103A','X103G','X103W','X103X','X103Y','X103Y','X103Z','X103a','X103b','X103c','X103d','X103e','X103f','X103h','X103i','X103j','X103k','X103l','X103m','X103n','X103o','X103p','X103q','X103r','X103s','X103u','X103v','X103w','X103x','X1043','X1044','X1045','X1046','X1047','X1048','X1049','X104B','X104C','X309R','X701k','X701k','X70Eg','X70RL','XE0YM','XE0YN','XE0YO','XE0YO','XE0YP','XE0YY','XE0Ya','XE0Ya','XE0Yb','XE0Yb','XE0ZN','XE0ZV','XE0ZX','XE0ZZ','XE0Zf','XE0Zh','XE0Zr','XE1NO','XE1ep','XE2Pp','XE2Pp','XM1Qc','XSC3p','Xa08A','Xa0BC','Xa0Qe','Xa0Qi','Xa0Qj','Xa0Tw','Xa35l','Xa9Bw','Xa9Bw','Xa9Bx','XaBDb','XaBDb','XaEIV','XaEIW','XaEIY','XaEKI','XaIND','XaIQT','XaIQg','XaIQg','XaIQh','XaIRO','XaIUt','XaIes','XaIes','XaIet','XaIu7','XaIu8','XaJ4k','XaJFu','XaJYf','XaJlS','XaJlT','XaJlU','XaJlV','XaJlW','XaJlY','XaK8Q','XaK8R','XaK8S','XaK8U','XaKv8','XaKv9','XaKzy','XaL2O','XaLcH','XaLqj','XaMzI','XaN4a','XaO5l','XaO5m','XaOYV','XaPZH','XaPZH','XaPls','XaPls','XaPlu','XaPlu','XaPzu','XaQvd','XaRCG','XaRCH','XaREX','XaREZ','XaREa','XaREd','XaW9D','XaXCa','XaXCb','XaXi9','XaXlE','XaXlF','XaXlJ','XaXnt','XaXzy','XaY05','XaY0w','XaYR1','XaYZO','XaYbA','XaYby','XaYuZ','XaZ6U','XaZ6U','XaZ8t','XaZd1','XaZee','XaZoz','XaZp7','XaZp8','XaZr7','Xaa7C','Xaam4','XaavA','Xabud','Xac33','Xac8s','XafhZ','Xafhe','Xafir','Xafit','Xafiu','Y1f1b','Y1f94','Y1f95','Y2708','Y2710') AND 1=1
            GROUP BY Patient_ID
            ), hiv AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('23E5.','663K.','7450','7450y','7450z','A114.','A115.','A7899','AD52.','C370.','C370.','C3700','C3701','C3701','C3702','C3703','C370z','H0614','H3...','H3...','H31..','H310.','H3100','H310z','H311.','H3110','H311z','H3121','H3122','H312z','H313.','H31y.','H31y0','H31y1','H31yz','H31z.','H32..','H320.','H3200','H3201','H3202','H3203','H320z','H321.','H322.','H32y.','H32y0','H32y1','H32y2','H32y2','H32yz','H32z.','H34..','H340.','H341.','H34z.','H35..','H35..','H350.','H351.','H352.','H3520','H3521','H352z','H353.','H354.','H355.','H356.','H357.','H35y.','H35y0','H35y1','H35y2','H35y3','H35y4','H35y5','H35y6','H35y7','H35y8','H35yz','H35z.','H35z0','H35z1','H3y..','H3y..','H3y0.','H3y1.','H3z..','H3z..','H4...','H40..','H41..','H41z.','H42..','H420.','H421.','H422.','H423.','H42z.','H43..','H430.','H431.','H432.','H433.','H434.','H435.','H43z.','H44..','H440.','H441.','H44z.','H45..','H450.','H460.','H4601','H460z','H464.','H4640','H4641','H4642','H464z','H46z0','H47..','H4y0.','H4y00','H4y0z','H4y1.','H4y10','H4y1z','H4y2.','H4y20','H4y21','H52y1','H5302','H5410','H55..','H561.','H563.','H5631','H563z','H56y0','H571.','H572.','H57y0','H57y1','H57y2','H57y3','H57y4','H581.','H582.','H583.','H591.','Hy02.','Hyu30','Hyu31','Hyu40','Hyu41','Hyu43','Hyu47','Hyu50','K260.','L380.','N0421','N0421','N04y0','P851.','P861.','PK35.','Q317.','Q3170','Q3171','Q3172','Q317z','Qyu36','SP130','SP131','X00s1','X00s2','X00s3','X00s4','X100V','X100l','X100m','X100n','X100o','X100p','X100q','X100r','X100t','X101U','X101U','X101X','X101Z','X101a','X101b','X101c','X101d','X101e','X101i','X101j','X101k','X101l','X101m','X101n','X101o','X101p','X101q','X101r','X1025','X1026','X1027','X1028','X102B','X102H','X102J','X102K','X102L','X102M','X102N','X102O','X102P','X102Q','X102R','X102S','X102T','X102U','X102j','X102j','X102k','X102u','X102v','X102v','X102w','X102x','X102y','X102z','X1030','X1031','X1032','X1033','X1034','X1035','X1038','X103A','X103G','X103W','X103X','X103Y','X103Y','X103Z','X103a','X103b','X103c','X103d','X103e','X103f','X103h','X103i','X103j','X103k','X103l','X103m','X103n','X103o','X103p','X103q','X103r','X103s','X103u','X103v','X103w','X103x','X1043','X1044','X1045','X1046','X1047','X1048','X1049','X104B','X104C','X309R','X701k','X701k','X70Eg','X70RL','XE0YM','XE0YN','XE0YO','XE0YO','XE0YP','XE0YY','XE0Ya','XE0Ya','XE0Yb','XE0Yb','XE0ZN','XE0ZV','XE0ZX','XE0ZZ','XE0Zf','XE0Zh','XE0Zr','XE1NO','XE1ep','XE2Pp','XE2Pp','XM1Qc','XSC3p','Xa08A','Xa0BC','Xa0Qe','Xa0Qi','Xa0Qj','Xa0Tw','Xa35l','Xa9Bw','Xa9Bw','Xa9Bx','XaBDb','XaBDb','XaEIV','XaEIW','XaEIY','XaEKI','XaIND','XaIQT','XaIQg','XaIQg','XaIQh','XaIRO','XaIUt','XaIes','XaIes','XaIet','XaIu7','XaIu8','XaJ4k','XaJFu','XaJYf','XaJlS','XaJlT','XaJlU','XaJlV','XaJlW','XaJlY','XaK8Q','XaK8R','XaK8S','XaK8U','XaKv8','XaKv9','XaKzy','XaL2O','XaLcH','XaLqj','XaMzI','XaN4a','XaO5l','XaO5m','XaOYV','XaPZH','XaPZH','XaPls','XaPls','XaPlu','XaPlu','XaPzu','XaQvd','XaRCG','XaRCH','XaREX','XaREZ','XaREa','XaREd','XaW9D','XaXCa','XaXCb','XaXi9','XaXlE','XaXlF','XaXlJ','XaXnt','XaXzy','XaY05','XaY0w','XaYR1','XaYZO','XaYbA','XaYby','XaYuZ','XaZ6U','XaZ6U','XaZ8t','XaZd1','XaZee','XaZoz','XaZp7','XaZp8','XaZr7','Xaa7C','Xaam4','XaavA','Xabud','Xac33','Xac8s','XafhZ','Xafhe','Xafir','Xafit','Xafiu','Y1f1b','Y1f94','Y1f95','Y2708','Y2710') AND 1=1
            GROUP BY Patient_ID
            ), genetic_immunodeficiency AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('23E5.','663K.','7450','7450y','7450z','A114.','A115.','A7899','AD52.','C370.','C370.','C3700','C3701','C3701','C3702','C3703','C370z','H0614','H3...','H3...','H31..','H310.','H3100','H310z','H311.','H3110','H311z','H3121','H3122','H312z','H313.','H31y.','H31y0','H31y1','H31yz','H31z.','H32..','H320.','H3200','H3201','H3202','H3203','H320z','H321.','H322.','H32y.','H32y0','H32y1','H32y2','H32y2','H32yz','H32z.','H34..','H340.','H341.','H34z.','H35..','H35..','H350.','H351.','H352.','H3520','H3521','H352z','H353.','H354.','H355.','H356.','H357.','H35y.','H35y0','H35y1','H35y2','H35y3','H35y4','H35y5','H35y6','H35y7','H35y8','H35yz','H35z.','H35z0','H35z1','H3y..','H3y..','H3y0.','H3y1.','H3z..','H3z..','H4...','H40..','H41..','H41z.','H42..','H420.','H421.','H422.','H423.','H42z.','H43..','H430.','H431.','H432.','H433.','H434.','H435.','H43z.','H44..','H440.','H441.','H44z.','H45..','H450.','H460.','H4601','H460z','H464.','H4640','H4641','H4642','H464z','H46z0','H47..','H4y0.','H4y00','H4y0z','H4y1.','H4y10','H4y1z','H4y2.','H4y20','H4y21','H52y1','H5302','H5410','H55..','H561.','H563.','H5631','H563z','H56y0','H571.','H572.','H57y0','H57y1','H57y2','H57y3','H57y4','H581.','H582.','H583.','H591.','Hy02.','Hyu30','Hyu31','Hyu40','Hyu41','Hyu43','Hyu47','Hyu50','K260.','L380.','N0421','N0421','N04y0','P851.','P861.','PK35.','Q317.','Q3170','Q3171','Q3172','Q317z','Qyu36','SP130','SP131','X00s1','X00s2','X00s3','X00s4','X100V','X100l','X100m','X100n','X100o','X100p','X100q','X100r','X100t','X101U','X101U','X101X','X101Z','X101a','X101b','X101c','X101d','X101e','X101i','X101j','X101k','X101l','X101m','X101n','X101o','X101p','X101q','X101r','X1025','X1026','X1027','X1028','X102B','X102H','X102J','X102K','X102L','X102M','X102N','X102O','X102P','X102Q','X102R','X102S','X102T','X102U','X102j','X102j','X102k','X102u','X102v','X102v','X102w','X102x','X102y','X102z','X1030','X1031','X1032','X1033','X1034','X1035','X1038','X103A','X103G','X103W','X103X','X103Y','X103Y','X103Z','X103a','X103b','X103c','X103d','X103e','X103f','X103h','X103i','X103j','X103k','X103l','X103m','X103n','X103o','X103p','X103q','X103r','X103s','X103u','X103v','X103w','X103x','X1043','X1044','X1045','X1046','X1047','X1048','X1049','X104B','X104C','X309R','X701k','X701k','X70Eg','X70RL','XE0YM','XE0YN','XE0YO','XE0YO','XE0YP','XE0YY','XE0Ya','XE0Ya','XE0Yb','XE0Yb','XE0ZN','XE0ZV','XE0ZX','XE0ZZ','XE0Zf','XE0Zh','XE0Zr','XE1NO','XE1ep','XE2Pp','XE2Pp','XM1Qc','XSC3p','Xa08A','Xa0BC','Xa0Qe','Xa0Qi','Xa0Qj','Xa0Tw','Xa35l','Xa9Bw','Xa9Bw','Xa9Bx','XaBDb','XaBDb','XaEIV','XaEIW','XaEIY','XaEKI','XaIND','XaIQT','XaIQg','XaIQg','XaIQh','XaIRO','XaIUt','XaIes','XaIes','XaIet','XaIu7','XaIu8','XaJ4k','XaJFu','XaJYf','XaJlS','XaJlT','XaJlU','XaJlV','XaJlW','XaJlY','XaK8Q','XaK8R','XaK8S','XaK8U','XaKv8','XaKv9','XaKzy','XaL2O','XaLcH','XaLqj','XaMzI','XaN4a','XaO5l','XaO5m','XaOYV','XaPZH','XaPZH','XaPls','XaPls','XaPlu','XaPlu','XaPzu','XaQvd','XaRCG','XaRCH','XaREX','XaREZ','XaREa','XaREd','XaW9D','XaXCa','XaXCb','XaXi9','XaXlE','XaXlF','XaXlJ','XaXnt','XaXzy','XaY05','XaY0w','XaYR1','XaYZO','XaYbA','XaYby','XaYuZ','XaZ6U','XaZ6U','XaZ8t','XaZd1','XaZee','XaZoz','XaZp7','XaZp8','XaZr7','Xaa7C','Xaam4','XaavA','Xabud','Xac33','Xac8s','XafhZ','Xafhe','Xafir','Xafit','Xafiu','Y1f1b','Y1f94','Y1f95','Y2708','Y2710') AND 1=1
            GROUP BY Patient_ID
            ), immunosuppression_nos AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('23E5.','663K.','7450','7450y','7450z','A114.','A115.','A7899','AD52.','C370.','C370.','C3700','C3701','C3701','C3702','C3703','C370z','H0614','H3...','H3...','H31..','H310.','H3100','H310z','H311.','H3110','H311z','H3121','H3122','H312z','H313.','H31y.','H31y0','H31y1','H31yz','H31z.','H32..','H320.','H3200','H3201','H3202','H3203','H320z','H321.','H322.','H32y.','H32y0','H32y1','H32y2','H32y2','H32yz','H32z.','H34..','H340.','H341.','H34z.','H35..','H35..','H350.','H351.','H352.','H3520','H3521','H352z','H353.','H354.','H355.','H356.','H357.','H35y.','H35y0','H35y1','H35y2','H35y3','H35y4','H35y5','H35y6','H35y7','H35y8','H35yz','H35z.','H35z0','H35z1','H3y..','H3y..','H3y0.','H3y1.','H3z..','H3z..','H4...','H40..','H41..','H41z.','H42..','H420.','H421.','H422.','H423.','H42z.','H43..','H430.','H431.','H432.','H433.','H434.','H435.','H43z.','H44..','H440.','H441.','H44z.','H45..','H450.','H460.','H4601','H460z','H464.','H4640','H4641','H4642','H464z','H46z0','H47..','H4y0.','H4y00','H4y0z','H4y1.','H4y10','H4y1z','H4y2.','H4y20','H4y21','H52y1','H5302','H5410','H55..','H561.','H563.','H5631','H563z','H56y0','H571.','H572.','H57y0','H57y1','H57y2','H57y3','H57y4','H581.','H582.','H583.','H591.','Hy02.','Hyu30','Hyu31','Hyu40','Hyu41','Hyu43','Hyu47','Hyu50','K260.','L380.','N0421','N0421','N04y0','P851.','P861.','PK35.','Q317.','Q3170','Q3171','Q3172','Q317z','Qyu36','SP130','SP131','X00s1','X00s2','X00s3','X00s4','X100V','X100l','X100m','X100n','X100o','X100p','X100q','X100r','X100t','X101U','X101U','X101X','X101Z','X101a','X101b','X101c','X101d','X101e','X101i','X101j','X101k','X101l','X101m','X101n','X101o','X101p','X101q','X101r','X1025','X1026','X1027','X1028','X102B','X102H','X102J','X102K','X102L','X102M','X102N','X102O','X102P','X102Q','X102R','X102S','X102T','X102U','X102j','X102j','X102k','X102u','X102v','X102v','X102w','X102x','X102y','X102z','X1030','X1031','X1032','X1033','X1034','X1035','X1038','X103A','X103G','X103W','X103X','X103Y','X103Y','X103Z','X103a','X103b','X103c','X103d','X103e','X103f','X103h','X103i','X103j','X103k','X103l','X103m','X103n','X103o','X103p','X103q','X103r','X103s','X103u','X103v','X103w','X103x','X1043','X1044','X1045','X1046','X1047','X1048','X1049','X104B','X104C','X309R','X701k','X701k','X70Eg','X70RL','XE0YM','XE0YN','XE0YO','XE0YO','XE0YP','XE0YY','XE0Ya','XE0Ya','XE0Yb','XE0Yb','XE0ZN','XE0ZV','XE0ZX','XE0ZZ','XE0Zf','XE0Zh','XE0Zr','XE1NO','XE1ep','XE2Pp','XE2Pp','XM1Qc','XSC3p','Xa08A','Xa0BC','Xa0Qe','Xa0Qi','Xa0Qj','Xa0Tw','Xa35l','Xa9Bw','Xa9Bw','Xa9Bx','XaBDb','XaBDb','XaEIV','XaEIW','XaEIY','XaEKI','XaIND','XaIQT','XaIQg','XaIQg','XaIQh','XaIRO','XaIUt','XaIes','XaIes','XaIet','XaIu7','XaIu8','XaJ4k','XaJFu','XaJYf','XaJlS','XaJlT','XaJlU','XaJlV','XaJlW','XaJlY','XaK8Q','XaK8R','XaK8S','XaK8U','XaKv8','XaKv9','XaKzy','XaL2O','XaLcH','XaLqj','XaMzI','XaN4a','XaO5l','XaO5m','XaOYV','XaPZH','XaPZH','XaPls','XaPls','XaPlu','XaPlu','XaPzu','XaQvd','XaRCG','XaRCH','XaREX','XaREZ','XaREa','XaREd','XaW9D','XaXCa','XaXCb','XaXi9','XaXlE','XaXlF','XaXlJ','XaXnt','XaXzy','XaY05','XaY0w','XaYR1','XaYZO','XaYbA','XaYby','XaYuZ','XaZ6U','XaZ6U','XaZ8t','XaZd1','XaZee','XaZoz','XaZp7','XaZp8','XaZr7','Xaa7C','Xaam4','XaavA','Xabud','Xac33','Xac8s','XafhZ','Xafhe','Xafir','Xafit','Xafiu','Y1f1b','Y1f94','Y1f95','Y2708','Y2710') AND 1=1
            GROUP BY Patient_ID
            ), bp_sys AS (
        SELECT
          days.Patient_ID AS patient_id,
          AVG(CodedEvent.NumericValue) AS mean_value,
          CONVERT(VARCHAR(7), days.date_measured, 23) AS date_measured
        FROM (
            SELECT Patient_ID, CAST(MAX(ConsultationDate) AS date) AS date_measured
            FROM CodedEvent
            WHERE CTV3Code IN ('2469.') AND ConsultationDate <= '2020-02-01'
            GROUP BY Patient_ID
        ) AS days
        LEFT JOIN CodedEvent
        ON (
          CodedEvent.Patient_ID = days.Patient_ID
          AND CodedEvent.CTV3Code IN ('2469.')
          AND CAST(CodedEvent.ConsultationDate AS date) = days.date_measured
        )
        GROUP BY days.Patient_ID, days.date_measured
        ), bp_dias AS (
        SELECT
          days.Patient_ID AS patient_id,
          AVG(CodedEvent.NumericValue) AS mean_value,
          CONVERT(VARCHAR(7), days.date_measured, 23) AS date_measured
        FROM (
            SELECT Patient_ID, CAST(MAX(ConsultationDate) AS date) AS date_measured
            FROM CodedEvent
            WHERE CTV3Code IN ('246A.') AND ConsultationDate <= '2020-02-01'
            GROUP BY Patient_ID
        ) AS days
        LEFT JOIN CodedEvent
        ON (
          CodedEvent.Patient_ID = days.Patient_ID
          AND CodedEvent.CTV3Code IN ('246A.')
          AND CAST(CodedEvent.ConsultationDate AS date) = days.date_measured
        )
        GROUP BY days.Patient_ID, days.date_measured
        ), ra_sle_psoriasis AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('14F2.','F3710','F3961','F4D33','H57y4','K01x4','M07y0','M143.','M154.','M1540','M1541','M1542','M1543','M1544','M1545','M1546','M154z','M16..','M160.','M160.','M1600','M160z','M161.','M1610','M1611','M1612','M1613','M1614','M1615','M1616','M1617','M1618','M1619','M161A','M161B','M161C','M161D','M161E','M161F','M161z','M16y.','M16z.','Myu30','Myu78','N000.','N0002','N000z','Nyu13','Nyu43','X00Dx','X00Dx','X30Kn','X30Ko','X30Kp','X30Kq','X30Kr','X30Ks','X506Y','X506Z','X506a','X506b','X506c','X506d','X506e','X506f','X506g','X506i','X506k','X506l','X506m','X506o','X506p','X506q','X506r','X506s','X506t','X506u','X506v','X50Ew','X50Ex','X50Ez','X50JD','X701u','X701v','X701w','X7026','X7027','X7028','X704W','X704X','X704a','X704b','X704c','X704d','X704g','X704h','XE0da','XE0da','XE1CQ','XM197','XaBE1','XaC1J','XaNXa','XaNXa','XaNXt','XaNXt','XaYOv','XaYOx','N0431','X705I','X701o','X701r','N041.','X701k','X701k','N040T','14G1.','X701t','XE1Gi','N043z','X701p','X701s','N0433','F3964','X705t','X705v','2G27.','N0401','N042.','N0432','X701q','F3712','Xafj8','N040.','Xa3gN','Xa3gM','N040S','Xa3gL','Xa3gO','Xa3gP','XE1DU','XaZdB','XM1XV','XafjA','XafjB','XaaWW','XagLZ','XaaWt','XaaWu','XaaWv','XaaWx','XaaWw','Xafj9','N040A','N0409','N0404','N040F','N0400','N0406','N0405','N040K','N040B','N040M','N040D','N040L','N0408','N040J','N040C','N0402','N0403','N040G','N040H','N040E','N0407','X701m','X701j','N042z','N040Q','G5yA.','N0421','N0421','G5y8.','N0422','X103Y','X103Y','X701l','X701i','XaBMO','X701h','Xa3wk','N043.','X705u','Nyu11','Nyu12','Nyu10','Nyu1G','N04X.') AND 1=1
            GROUP BY Patient_ID
            ), gi_bleed_and_ulcer AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('X301F','J120.','J120z','J120y','J1201','J1203','J1204','J1202','J1200','J110.','J110z','J110y','J1101','J1101','J1103','J1104','J1102','J1100','J140.','J140z','J140y','J1401','J1403','J1404','J1402','J1400','X301O','J130.','J130z','X302A','X301E','J130y','J1301','J1303','J1304','J1302','J1300','Xa1qA','Xa1qA','XaLWs','XaLWt','XaLWq','XaLWr','X300M','J1025','X30Bh','XaB1x','X30Bg','XaBmb','XaBel','J1023','X301K','J121.','J121z','J121y','J1211','J1211','J1213','J1214','J1212','J1212','J1210','J111.','J111z','J111y','J1111','J1111','J1113','J1114','J1112','J1112','J1110','J141.','J141z','J141y','J1411','J1413','J1414','J1412','J1410','J131.','J131z','X302F','X301J','J131y','J1311','J1313','J1314','J1312','J1310','X70RT','761J1','XE0Cr','XE0Cr','773C6','76270','761J0','X20VM','76181','X302D','X301I','X302C','X301H','J1024','X30CK','X302G','J12..','J12z.','J122.','X302b','7627.','XaFBq','XaFBs','X300K','X30CJ','X301L','J68z0','XE0aP','XE0aP','J11..','XE0aQ','XE0aQ','761J.','761J.','J11z.','Xa7nW','J1020','Xa1qC','Xa1qC','X30CH','J68z.','J68..','J68..','XE0bJ','XE0bJ','J68zz','XE0aS','XE0aS','J14z.','76191','XM1RN','XM1RN','XM1RO','XM1RO','XE0qB','XE0qB','14C1.','X302H','XaB5h','X302a','J17y8','X300L','J68z1','Xa1qB','Xa1qB','X302x','XaB15','X30CN','X30Bi','J107.','XaB3K','X301M','X301M','XaELE','XaELE','XaMO8','XaMO7','XaMO6','XaMO5','Xa9C0','X30CI','Xa7TU','J10y0','J1022','7627z','761Jz','7627y','761Jy','Q414y','XaLdV','XaB8q','XaB8s','X20Vu','X20VN','XE0aR','XE0aR','J13z.','XM0BZ','X302c','X302X','1956.','XE0c1','XE0bz','XM0sI','XE0c5','X302Q','X301o','Q414.','Q414z','Xa6ot','Xa6ot','X302z','J57y8','X300O','Xa84h','Xa84h','X300P','J124.','XaB3J','76125','Xa00e','X40Ys','X30CM','X304I','Xa3u7','XaYMi','X302B','X301G','X300Q','XaB2R','76271','XaB2Q','XM1I9','XM1I9','J102.','J102z','J14..','J13..','J13..','XE0c3','J57y9','J57yA','X304H','X302w','XaB8r','XaFC4','J12yy','J11yy','J14y3','J14yy','J13yy','J12y.','J12yz','J12y1','J12y3','J12y4','J12y2','J12y0','J11y.','J11yz','J11y1','J11y3','J11y4','J11y2','J11y0','J14y.','J14yz','J14y1','J14y4','J14y2','J14y0','J13y.','J13yz','J13y1','J13y3','J13y4','J13y2','J13y0','X30Be','X300N','XaCLu','ZV127') AND 1=1
            GROUP BY Patient_ID
            ), inflammatory_bowel_disease AS (
            SELECT
              Patient_ID AS patient_id,
              1 AS has_event,
              CONVERT(VARCHAR(7), MIN(ConsultationDate), 23) AS first_date
            FROM CodedEvent
            WHERE CTV3Code IN ('14C4.','J08z9','J4...','J40..','J400.','J4000','J4001','J4002','J4003','J4004','J400z','J401.','J4010','J4010','J4011','J401z','J402.','J40z.','J40z.','J41..','J410.','J410.','J4100','J4103','J410z','J41y.','J41yz','J41z.','J41z.','Jyu40','Jyu41','N0310','N0311','N0453','N0454','X20Pq','X300J','X301b','X302r','X302t','X3030','X303k','X3050','XE0ae','XE0af','XE0af','XE0ag','XE0aj','XE0cX','XE0cZ','XE0qC','XE2QL','XE2QL','XM1RP','Xa0lh','Xa0lh','Xa3fm','Xa7nY','XaB5x','XaB5z','XaK6C','XaK6D','XaK6E','XaK6F','XaYzX','XaZ2j','Y2903') AND 1=1
            GROUP BY Patient_ID
            )
        SELECT
          population.patient_id, ISNULL(age.age, 0) AS age, ISNULL(sex.sex, 0) AS sex, ISNULL(imd.index_of_multiple_deprivation, 0) AS imd, ISNULL(rural_urban.rural_urban_classification, 0) AS rural_urban, ISNULL(geographic_area.stp_code, '') AS geographic_area, ISNULL(bmi.BMI, 0) AS bmi, ISNULL(bmi.date_measured, '') AS bmi_date_measured, ISNULL(chronic_respiratory_disease.first_date, '') AS chronic_respiratory_disease, ISNULL(chronic_cardiac_disease.first_date, '') AS chronic_cardiac_disease, ISNULL(diabetes.first_date, '') AS diabetes, ISNULL(lung_cancer.first_date, '') AS lung_cancer, ISNULL(haem_cancer.first_date, '') AS haem_cancer, ISNULL(other_cancer.first_date, '') AS other_cancer, ISNULL(bone_marrow_transplant.first_date, '') AS bone_marrow_transplant, ISNULL(chemo_radio_therapy.first_date, '') AS chemo_radio_therapy, ISNULL(chronic_liver_disease.first_date, '') AS chronic_liver_disease, ISNULL(neurological_condition.first_date, '') AS neurological_condition, ISNULL(dialysis.first_date, '') AS dialysis, ISNULL(organ_transplant.first_date, '') AS organ_transplant, ISNULL(dysplenia.first_date, '') AS dysplenia, ISNULL(sickle_cell.first_date, '') AS sickle_cell, ISNULL(aplastic_anaemia.first_date, '') AS aplastic_anaemia, ISNULL(hiv.first_date, '') AS hiv, ISNULL(genetic_immunodeficiency.first_date, '') AS genetic_immunodeficiency, ISNULL(immunosuppression_nos.first_date, '') AS immunosuppression_nos, ISNULL(bp_sys.mean_value, 0) AS bp_sys, ISNULL(bp_sys.date_measured, '') AS bp_sys_date_measured, ISNULL(bp_dias.mean_value, 0) AS bp_dias, ISNULL(bp_dias.date_measured, '') AS bp_dias_date_measured, ISNULL(ra_sle_psoriasis.first_date, '') AS ra_sle_psoriasis, ISNULL(gi_bleed_and_ulcer.first_date, '') AS gi_bleed_and_ulcer, ISNULL(inflammatory_bowel_disease.first_date, '') AS inflammatory_bowel_disease, CASE WHEN (( recent_asthma_code.has_event != 0 ) OR ( ( asthma_code_ever.has_event != 0 ) AND NOT ( copd_code_ever.has_event != 0 ) AND ( recent_salbutamol_count.count >= 3 OR ( recent_ics.has_event != 0 ) ) )) THEN 1 ELSE 0 END AS asthma
        FROM population
        LEFT JOIN age ON age.Patient_ID = population.Patient_ID LEFT JOIN sex ON sex.Patient_ID = population.Patient_ID LEFT JOIN imd ON imd.Patient_ID = population.Patient_ID LEFT JOIN rural_urban ON rural_urban.Patient_ID = population.Patient_ID LEFT JOIN geographic_area ON geographic_area.Patient_ID = population.Patient_ID LEFT JOIN bmi ON bmi.Patient_ID = population.Patient_ID LEFT JOIN chronic_respiratory_disease ON chronic_respiratory_disease.Patient_ID = population.Patient_ID LEFT JOIN recent_asthma_code ON recent_asthma_code.Patient_ID = population.Patient_ID LEFT JOIN asthma_code_ever ON asthma_code_ever.Patient_ID = population.Patient_ID LEFT JOIN copd_code_ever ON copd_code_ever.Patient_ID = population.Patient_ID LEFT JOIN recent_salbutamol_count ON recent_salbutamol_count.Patient_ID = population.Patient_ID LEFT JOIN recent_ics ON recent_ics.Patient_ID = population.Patient_ID LEFT JOIN chronic_cardiac_disease ON chronic_cardiac_disease.Patient_ID = population.Patient_ID LEFT JOIN diabetes ON diabetes.Patient_ID = population.Patient_ID LEFT JOIN lung_cancer ON lung_cancer.Patient_ID = population.Patient_ID LEFT JOIN haem_cancer ON haem_cancer.Patient_ID = population.Patient_ID LEFT JOIN other_cancer ON other_cancer.Patient_ID = population.Patient_ID LEFT JOIN bone_marrow_transplant ON bone_marrow_transplant.Patient_ID = population.Patient_ID LEFT JOIN chemo_radio_therapy ON chemo_radio_therapy.Patient_ID = population.Patient_ID LEFT JOIN chronic_liver_disease ON chronic_liver_disease.Patient_ID = population.Patient_ID LEFT JOIN neurological_condition ON neurological_condition.Patient_ID = population.Patient_ID LEFT JOIN dialysis ON dialysis.Patient_ID = population.Patient_ID LEFT JOIN organ_transplant ON organ_transplant.Patient_ID = population.Patient_ID LEFT JOIN dysplenia ON dysplenia.Patient_ID = population.Patient_ID LEFT JOIN sickle_cell ON sickle_cell.Patient_ID = population.Patient_ID LEFT JOIN aplastic_anaemia ON aplastic_anaemia.Patient_ID = population.Patient_ID LEFT JOIN hiv ON hiv.Patient_ID = population.Patient_ID LEFT JOIN genetic_immunodeficiency ON genetic_immunodeficiency.Patient_ID = population.Patient_ID LEFT JOIN immunosuppression_nos ON immunosuppression_nos.Patient_ID = population.Patient_ID LEFT JOIN bp_sys ON bp_sys.Patient_ID = population.Patient_ID LEFT JOIN bp_dias ON bp_dias.Patient_ID = population.Patient_ID LEFT JOIN ra_sle_psoriasis ON ra_sle_psoriasis.Patient_ID = population.Patient_ID LEFT JOIN gi_bleed_and_ulcer ON gi_bleed_and_ulcer.Patient_ID = population.Patient_ID LEFT JOIN inflammatory_bowel_disease ON inflammatory_bowel_disease.Patient_ID = population.Patient_ID

